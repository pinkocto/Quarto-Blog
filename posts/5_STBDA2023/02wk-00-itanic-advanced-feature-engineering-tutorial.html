<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.315">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JiyunLim">
<meta name="dcterms.date" content="2023-09-10">

<title>Quarto-Blog - 타이타닉 튜토리얼</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Quarto-Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pinkocto"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">타이타닉 튜토리얼</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">타이타닉 튜토리얼</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JiyunLim </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../1_ip2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IP2022</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../2_dv2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DV2022</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../3_stbda2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STBDA2022</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../5_stbda2023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STBDA2023</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../7_study.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STUDY</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><strong>0. Introduction</strong></a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><strong>1. Exploratory Data Analysis</strong></a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><strong>1.1 Overview</strong></a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><strong>1.2 Missing Values</strong></a></li>
  <li><a href="#target-distribution" id="toc-target-distribution" class="nav-link" data-scroll-target="#target-distribution"><strong>1.3 Target Distribution</strong></a></li>
  <li><a href="#correlations" id="toc-correlations" class="nav-link" data-scroll-target="#correlations"><strong>1.4 Correlations</strong></a></li>
  <li><a href="#target-distribution-in-features" id="toc-target-distribution-in-features" class="nav-link" data-scroll-target="#target-distribution-in-features"><strong>1.5 Target Distribution in Features</strong></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><strong>1.6 Conclusion</strong></a></li>
  </ul></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering"><strong>2. Feature Engineering</strong></a>
  <ul class="collapse">
  <li><a href="#binning-continuous-features" id="toc-binning-continuous-features" class="nav-link" data-scroll-target="#binning-continuous-features"><strong>2.1 Binning Continuous Features</strong></a></li>
  <li><a href="#frequency-encoding" id="toc-frequency-encoding" class="nav-link" data-scroll-target="#frequency-encoding"><strong>2.2 Frequency Encoding</strong></a></li>
  <li><a href="#title-is-married" id="toc-title-is-married" class="nav-link" data-scroll-target="#title-is-married"><strong>2.3 Title &amp; Is Married</strong></a></li>
  <li><a href="#target-encoding" id="toc-target-encoding" class="nav-link" data-scroll-target="#target-encoding"><strong>2.4 Target Encoding</strong></a></li>
  <li><a href="#feature-transformation" id="toc-feature-transformation" class="nav-link" data-scroll-target="#feature-transformation"><strong>2.5 Feature Transformation</strong></a></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1"><strong>2.6 Conclusion</strong></a></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><strong>3. Model</strong></a>
  <ul class="collapse">
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><strong>3.1 Random Forest</strong></a></li>
  <li><a href="#feature-importance" id="toc-feature-importance" class="nav-link" data-scroll-target="#feature-importance"><strong>3.2 Feature Importance</strong></a></li>
  <li><a href="#roc-curve" id="toc-roc-curve" class="nav-link" data-scroll-target="#roc-curve"><strong>3.3 ROC Curve</strong></a></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission"><strong>3.4 Submission</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>0. Introduction</strong></h2>
<p>I decided to write this kernel because <strong>Titanic: Machine Learning from Disaster</strong> is one of my favorite competitions on Kaggle. This is a beginner level kernel which focuses on <strong>Exploratory Data Analysis</strong> and <strong>Feature Engineering</strong>. A lot of people start Kaggle with this competition and they get lost in extremely long tutorial kernels. This is a short kernel compared to the other ones. I hope this will be a good guide for starters and inspire them with new feature engineering ideas.</p>
<p><strong>Titanic: Machine Learning from Disaster</strong> is a great competition to apply domain knowledge for feature engineering, so I made a research and learned a lot about Titanic. There are many secrets to be revealed beneath the Titanic dataset. I tried to find out some of those secret factors that had affected the survival of passengers when the Titanic was sinking. I believe there are other features still waiting to be discovered.</p>
<p>This kernel has <strong>3</strong> main sections; <strong>Exploratory Data Analysis</strong>, <strong>Feature Engineering</strong> and <strong>Model</strong>, and it can achieve top <strong>2%</strong> (<strong>0.83732</strong>) public leaderboard score with a tuned Random Forest Classifier. It takes 60 seconds to run whole notebook. If you have any idea that might improve this kernel, please be sure to comment, or fork and experiment as you like. If you didn’t understand any part, feel free to ask.</p>
<p>::: {#cell-2 .cell _cell_guid=‘79c7e3d0-c299-4dcb-8224-4455121ee9b0’ _uuid=‘d629ff2d2480ee46fbb7e2d37f6b5fab8052498a’ execution_count=1}</p>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, LabelEncoder, StandardScaler</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="im">import</span> string</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="im">import</span> warnings</span>
<span id="cb1-15"><a href="#cb1-15"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>SEED <span class="op">=</span> <span class="dv">42</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<ul>
<li>Training set has <strong>891</strong> rows and test set has <strong>418</strong> rows</li>
<li>Training set have <strong>12</strong> features and test set have <strong>11</strong> features</li>
<li>One extra feature in training set is <code>Survived</code> feature, which is the target variable</li>
</ul>
<p>::: {#cell-4 .cell _uuid=‘467443fda7135a8ce89c4d537da3f3a8546e2384’ execution_count=2}</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">def</span> concat_df(train_data, test_data):</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="co"># Returns a concatenated df of training and test set</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="cf">return</span> pd.concat([train_data, test_data], sort<span class="op">=</span><span class="va">True</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">def</span> divide_df(all_data):</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="co"># Returns divided dfs of training and test set</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="cf">return</span> all_data.loc[:<span class="dv">890</span>], all_data.loc[<span class="dv">891</span>:].drop([<span class="st">'Survived'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>df_train <span class="op">=</span> pd.read_csv(<span class="st">'titanic/train.csv'</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a>df_test <span class="op">=</span> pd.read_csv(<span class="st">'titanic/test.csv'</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a>df_all <span class="op">=</span> concat_df(df_train, df_test)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a>df_train.name <span class="op">=</span> <span class="st">'Training Set'</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>df_test.name <span class="op">=</span> <span class="st">'Test Set'</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>df_all.name <span class="op">=</span> <span class="st">'All Set'</span> </span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a>dfs <span class="op">=</span> [df_train, df_test]</span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="bu">print</span>(<span class="st">'Number of Training Examples = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(df_train.shape[<span class="dv">0</span>]))</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="bu">print</span>(<span class="st">'Number of Test Examples = </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(df_test.shape[<span class="dv">0</span>]))</span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="bu">print</span>(<span class="st">'Training X Shape = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(df_train.shape))</span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="bu">print</span>(<span class="st">'Training y Shape = </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(df_train[<span class="st">'Survived'</span>].shape[<span class="dv">0</span>]))</span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="bu">print</span>(<span class="st">'Test X Shape = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(df_test.shape))</span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="bu">print</span>(<span class="st">'Test y Shape = </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(df_test.shape[<span class="dv">0</span>]))</span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="bu">print</span>(df_train.columns)</span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="bu">print</span>(df_test.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Training Examples = 891
Number of Test Examples = 418

Training X Shape = (891, 12)
Training y Shape = 891

Test X Shape = (418, 11)
Test y Shape = 418

Index(['PassengerId', 'Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp',
       'Parch', 'Ticket', 'Fare', 'Cabin', 'Embarked'],
      dtype='object')
Index(['PassengerId', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch',
       'Ticket', 'Fare', 'Cabin', 'Embarked'],
      dtype='object')</code></pre>
</div>
<p>:::</p>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis"><strong>1. Exploratory Data Analysis</strong></h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview"><strong>1.1 Overview</strong></h3>
<ul>
<li><code>PassengerId</code> is the unique id of the row and it doesn’t have any effect on target</li>
<li><code>Survived</code> is the target variable we are trying to predict (<strong>0</strong> or <strong>1</strong>):
<ul>
<li><strong>1 = Survived</strong></li>
<li><strong>0 = Not Survived</strong></li>
</ul></li>
<li><code>Pclass</code> (Passenger Class) is the socio-economic status of the passenger and it is a categorical ordinal feature which has <strong>3</strong> unique values (<strong>1</strong>, <strong>2 </strong>or <strong>3</strong>):
<ul>
<li><strong>1 = Upper Class</strong></li>
<li><strong>2 = Middle Class</strong></li>
<li><strong>3 = Lower Class</strong></li>
</ul></li>
<li><code>Name</code>, <code>Sex</code> and <code>Age</code> are self-explanatory</li>
<li><code>SibSp</code> is the total number of the passengers’ siblings and spouse</li>
<li><code>Parch</code> is the total number of the passengers’ parents and children</li>
<li><code>Ticket</code> is the ticket number of the passenger</li>
<li><code>Fare</code> is the passenger fare</li>
<li><code>Cabin</code> is the cabin number of the passenger</li>
<li><code>Embarked</code> is port of embarkation and it is a categorical feature which has <strong>3</strong> unique values (<strong>C</strong>, <strong>Q</strong> or <strong>S</strong>):
<ul>
<li><strong>C = Cherbourg</strong></li>
<li><strong>Q = Queenstown</strong></li>
<li><strong>S = Southampton</strong></li>
</ul></li>
</ul>
<p>::: {#cell-7 .cell _uuid=‘f02f321f8fd8b8c7c2a4aedb36ebe868ae51004e’ execution_count=3}</p>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="bu">print</span>(df_train.info())</span>
<span id="cb4-2"><a href="#cb4-2"></a>df_train.sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          714 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
dtypes: float64(2), int64(5), object(5)
memory usage: 83.7+ KB
None</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Survived</th>
<th data-quarto-table-cell-role="th">Pclass</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">SibSp</th>
<th data-quarto-table-cell-role="th">Parch</th>
<th data-quarto-table-cell-role="th">Ticket</th>
<th data-quarto-table-cell-role="th">Fare</th>
<th data-quarto-table-cell-role="th">Cabin</th>
<th data-quarto-table-cell-role="th">Embarked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">633</td>
<td>634</td>
<td>0</td>
<td>1</td>
<td>Parr, Mr. William Henry Marsh</td>
<td>male</td>
<td>NaN</td>
<td>0</td>
<td>0</td>
<td>112052</td>
<td>0.00</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">801</td>
<td>802</td>
<td>1</td>
<td>2</td>
<td>Collyer, Mrs. Harvey (Charlotte Annie Tate)</td>
<td>female</td>
<td>31.0</td>
<td>1</td>
<td>1</td>
<td>C.A. 31921</td>
<td>26.25</td>
<td>NaN</td>
<td>S</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">200</td>
<td>201</td>
<td>0</td>
<td>3</td>
<td>Vande Walle, Mr. Nestor Cyriel</td>
<td>male</td>
<td>28.0</td>
<td>0</td>
<td>0</td>
<td>345770</td>
<td>9.50</td>
<td>NaN</td>
<td>S</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
<p>::: {#cell-8 .cell _uuid=‘851ccf74127831d31ea0d7273b686f9a7cf20eee’ execution_count=4}</p>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="bu">print</span>(df_test.info())</span>
<span id="cb6-2"><a href="#cb6-2"></a>df_test.sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 418 entries, 0 to 417
Data columns (total 11 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  418 non-null    int64  
 1   Pclass       418 non-null    int64  
 2   Name         418 non-null    object 
 3   Sex          418 non-null    object 
 4   Age          332 non-null    float64
 5   SibSp        418 non-null    int64  
 6   Parch        418 non-null    int64  
 7   Ticket       418 non-null    object 
 8   Fare         417 non-null    float64
 9   Cabin        91 non-null     object 
 10  Embarked     418 non-null    object 
dtypes: float64(2), int64(4), object(5)
memory usage: 36.0+ KB
None</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Pclass</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">SibSp</th>
<th data-quarto-table-cell-role="th">Parch</th>
<th data-quarto-table-cell-role="th">Ticket</th>
<th data-quarto-table-cell-role="th">Fare</th>
<th data-quarto-table-cell-role="th">Cabin</th>
<th data-quarto-table-cell-role="th">Embarked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>927</td>
<td>3</td>
<td>Katavelas, Mr. Vassilios (Catavelas Vassilios")"</td>
<td>male</td>
<td>18.5</td>
<td>0</td>
<td>0</td>
<td>2682</td>
<td>7.2292</td>
<td>NaN</td>
<td>C</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>921</td>
<td>3</td>
<td>Samaan, Mr. Elias</td>
<td>male</td>
<td>NaN</td>
<td>2</td>
<td>0</td>
<td>2662</td>
<td>21.6792</td>
<td>NaN</td>
<td>C</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">135</td>
<td>1027</td>
<td>3</td>
<td>Carlsson, Mr. Carl Robert</td>
<td>male</td>
<td>24.0</td>
<td>0</td>
<td>0</td>
<td>350409</td>
<td>7.8542</td>
<td>NaN</td>
<td>S</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
</section>
<section id="missing-values" class="level3">
<h3 class="anchored" data-anchor-id="missing-values"><strong>1.2 Missing Values</strong></h3>
<p>As seen from below, some columns have missing values. <code>display_missing</code> function shows the count of missing values in every column in both training and test set. * Training set have missing values in <code>Age</code>, <code>Cabin</code> and <code>Embarked</code> columns * Test set have missing values in <code>Age</code>, <code>Cabin</code> and <code>Fare</code> columns</p>
<p>It is convenient to work on concatenated training and test set while dealing with missing values, otherwise filled data may overfit to training or test set samples. The count of missing values in <code>Age</code>, <code>Embarked</code> and <code>Fare</code> are smaller compared to total sample, but roughly <strong>80%</strong> of the <code>Cabin</code> is missing. Missing values in <code>Age</code>, <code>Embarked</code> and <code>Fare</code> can be filled with descriptive statistical measures but that wouldn’t work for <code>Cabin</code>.</p>
<p>::: {#cell-10 .cell _kg_hide-input=‘true’ _uuid=‘d4e8f7b72e2bd165cafa71d67c95f008e7c6101d’ execution_count=5}</p>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">def</span> display_missing(df):    </span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns.tolist():          </span>
<span id="cb8-3"><a href="#cb8-3"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> column missing values: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(col, df[col].isnull().<span class="bu">sum</span>()))</span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>    </span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="cf">for</span> df <span class="kw">in</span> dfs:</span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(df.name))</span>
<span id="cb8-8"><a href="#cb8-8"></a>    display_missing(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training Set
PassengerId column missing values: 0
Survived column missing values: 0
Pclass column missing values: 0
Name column missing values: 0
Sex column missing values: 0
Age column missing values: 177
SibSp column missing values: 0
Parch column missing values: 0
Ticket column missing values: 0
Fare column missing values: 0
Cabin column missing values: 687
Embarked column missing values: 2


Test Set
PassengerId column missing values: 0
Pclass column missing values: 0
Name column missing values: 0
Sex column missing values: 0
Age column missing values: 86
SibSp column missing values: 0
Parch column missing values: 0
Ticket column missing values: 0
Fare column missing values: 1
Cabin column missing values: 327
Embarked column missing values: 0

</code></pre>
</div>
<p>:::</p>
<section id="age" class="level4">
<h4 class="anchored" data-anchor-id="age"><strong>1.2.1 Age</strong></h4>
<p>Missing values in <code>Age</code> are filled with median age, but using median age of the whole data set is not a good choice. Median age of <code>Pclass</code> groups is the best choice because of its high correlation with <code>Age</code> <strong>(0.408106)</strong> and <code>Survived</code> <strong>(0.338481)</strong>. It is also more logical to group ages by passenger classes instead of other features.</p>
<p>::: {#cell-12 .cell _kg_hide-input=‘true’ execution_count=6}</p>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>df_all_corr <span class="op">=</span> df_all.corr().<span class="bu">abs</span>().unstack().sort_values(kind<span class="op">=</span><span class="st">"quicksort"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb10-2"><a href="#cb10-2"></a>df_all_corr.rename(columns<span class="op">=</span>{<span class="st">"level_0"</span>: <span class="st">"Feature 1"</span>, <span class="st">"level_1"</span>: <span class="st">"Feature 2"</span>, <span class="dv">0</span>: <span class="st">'Correlation Coefficient'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a>df_all_corr[df_all_corr[<span class="st">'Feature 1'</span>] <span class="op">==</span> <span class="st">'Age'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature 1</th>
<th data-quarto-table-cell-role="th">Feature 2</th>
<th data-quarto-table-cell-role="th">Correlation Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Age</td>
<td>Age</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Age</td>
<td>Pclass</td>
<td>0.408106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Age</td>
<td>SibSp</td>
<td>0.243699</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Age</td>
<td>Fare</td>
<td>0.178740</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Age</td>
<td>Parch</td>
<td>0.150917</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>Age</td>
<td>Survived</td>
<td>0.077221</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>Age</td>
<td>PassengerId</td>
<td>0.028814</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
<p>In order to be more accurate, <code>Sex</code> feature is used as the second level of <code>groupby</code> while filling the missing <code>Age</code> values. As seen from below, <code>Pclass</code> and <code>Sex</code> groups have distinct median <code>Age</code> values. When passenger class increases, the median age for both males and females also increases. However, females tend to have slightly lower median <code>Age</code> than males. The median ages below are used for filling the missing values in <code>Age</code> feature.</p>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>age_by_pclass_sex <span class="op">=</span> df_all.groupby([<span class="st">'Sex'</span>, <span class="st">'Pclass'</span>]).median()[<span class="st">'Age'</span>]</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="cf">for</span> pclass <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span>):</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="cf">for</span> sex <span class="kw">in</span> [<span class="st">'female'</span>, <span class="st">'male'</span>]:</span>
<span id="cb11-5"><a href="#cb11-5"></a>        <span class="bu">print</span>(<span class="st">'Median age of Pclass </span><span class="sc">{}</span><span class="st"> </span><span class="sc">{}</span><span class="st">s: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(pclass, sex, age_by_pclass_sex[sex][pclass]))</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="bu">print</span>(<span class="st">'Median age of all passengers: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(df_all[<span class="st">'Age'</span>].median()))</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># Filling the missing values in Age with the medians of Sex and Pclass groups</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>df_all[<span class="st">'Age'</span>] <span class="op">=</span> df_all.groupby([<span class="st">'Sex'</span>, <span class="st">'Pclass'</span>])[<span class="st">'Age'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.fillna(x.median()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Median age of Pclass 1 females: 36.0
Median age of Pclass 1 males: 42.0
Median age of Pclass 2 females: 28.0
Median age of Pclass 2 males: 29.5
Median age of Pclass 3 females: 22.0
Median age of Pclass 3 males: 25.0
Median age of all passengers: 28.0</code></pre>
</div>
</div>
</section>
<section id="embarked" class="level4">
<h4 class="anchored" data-anchor-id="embarked"><strong>1.2.2 Embarked</strong></h4>
<p><code>Embarked</code> is a categorical feature and there are only <strong>2</strong> missing values in whole data set. Both of those passengers are female, upper class and they have the same ticket number. This means that they know each other and embarked from the same port together. The mode <code>Embarked</code> value for an upper class female passenger is <strong>C (Cherbourg)</strong>, but this doesn’t necessarily mean that they embarked from that port.</p>
<p>::: {#cell-16 .cell _kg_hide-input=‘true’ execution_count=8}</p>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>df_all[df_all[<span class="st">'Embarked'</span>].isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Cabin</th>
<th data-quarto-table-cell-role="th">Embarked</th>
<th data-quarto-table-cell-role="th">Fare</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Parch</th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Pclass</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">SibSp</th>
<th data-quarto-table-cell-role="th">Survived</th>
<th data-quarto-table-cell-role="th">Ticket</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>38.0</td>
<td>B28</td>
<td>NaN</td>
<td>80.0</td>
<td>Icard, Miss. Amelie</td>
<td>0</td>
<td>62</td>
<td>1</td>
<td>female</td>
<td>0</td>
<td>1.0</td>
<td>113572</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">829</td>
<td>62.0</td>
<td>B28</td>
<td>NaN</td>
<td>80.0</td>
<td>Stone, Mrs. George Nelson (Martha Evelyn)</td>
<td>0</td>
<td>830</td>
<td>1</td>
<td>female</td>
<td>0</td>
<td>1.0</td>
<td>113572</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
<p>When I googled <strong>Stone, Mrs.&nbsp;George Nelson (Martha Evelyn)</strong>, I found that she embarked from <strong>S (Southampton)</strong> with her maid <strong>Amelie Icard</strong>, in this page <a href="https://www.encyclopedia-titanica.org/titanic-survivor/martha-evelyn-stone.html">Martha Evelyn Stone: Titanic Survivor</a>.</p>
<blockquote class="blockquote">
<p><em>Mrs Stone boarded the Titanic in Southampton on 10 April 1912 and was travelling in first class with her maid Amelie Icard. She occupied cabin B-28.</em></p>
</blockquote>
<p>Missing values in <code>Embarked</code> are filled with <strong>S</strong> with this information.</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Filling the missing values in Embarked with S</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>df_all[<span class="st">'Embarked'</span>] <span class="op">=</span> df_all[<span class="st">'Embarked'</span>].fillna(<span class="st">'S'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fare" class="level4">
<h4 class="anchored" data-anchor-id="fare"><strong>1.2.3 Fare</strong></h4>
<p>There is only one passenger with missing <code>Fare</code> value. We can assume that <code>Fare</code> is related to family size (<code>Parch</code> and <code>SibSp</code>) and <code>Pclass</code> features. Median <code>Fare</code> value of a male with a third class ticket and no family is a logical choice to fill the missing value.</p>
<p>::: {#cell-20 .cell _kg_hide-input=‘true’ execution_count=10}</p>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>df_all[df_all[<span class="st">'Fare'</span>].isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Cabin</th>
<th data-quarto-table-cell-role="th">Embarked</th>
<th data-quarto-table-cell-role="th">Fare</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Parch</th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Pclass</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">SibSp</th>
<th data-quarto-table-cell-role="th">Survived</th>
<th data-quarto-table-cell-role="th">Ticket</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1043</td>
<td>60.5</td>
<td>NaN</td>
<td>S</td>
<td>NaN</td>
<td>Storey, Mr. Thomas</td>
<td>0</td>
<td>1044</td>
<td>3</td>
<td>male</td>
<td>0</td>
<td>NaN</td>
<td>3701</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>med_fare <span class="op">=</span> df_all.groupby([<span class="st">'Pclass'</span>, <span class="st">'Parch'</span>, <span class="st">'SibSp'</span>]).Fare.median()[<span class="dv">3</span>][<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># Filling the missing value in Fare with the median Fare of 3rd class alone passenger</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>df_all[<span class="st">'Fare'</span>] <span class="op">=</span> df_all[<span class="st">'Fare'</span>].fillna(med_fare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cabin" class="level4">
<h4 class="anchored" data-anchor-id="cabin"><strong>1.2.4 Cabin</strong></h4>
<p><code>Cabin</code> feature is little bit tricky and it needs further exploration. The large portion of the <code>Cabin</code> feature is missing and the feature itself can’t be ignored completely because some the cabins might have higher survival rates. It turns out to be the first letter of the <code>Cabin</code> values are the decks in which the cabins are located. Those decks were mainly separated for one passenger class, but some of them were used by multiple passenger classes. <img src="https://vignette.wikia.nocookie.net/titanic/images/f/f9/Titanic_side_plan.png/revision/latest?cb=20180322183733.png" class="img-fluid" alt="alt text"> * On the Boat Deck there were <strong>6</strong> rooms labeled as <strong>T, U, W, X, Y, Z</strong> but only the <strong>T</strong> cabin is present in the dataset * <strong>A</strong>, <strong>B</strong> and <strong>C</strong> decks were only for 1st class passengers * <strong>D</strong> and <strong>E</strong> decks were for all classes * <strong>F</strong> and <strong>G</strong> decks were for both 2nd and 3rd class passengers * From going <strong>A</strong> to <strong>G</strong>, distance to the staircase increases which might be a factor of survival</p>
<p>::: {#cell-23 .cell _kg_hide-input=‘true’ execution_count=12}</p>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Creating Deck column from the first letter of the Cabin column (M stands for Missing)</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>df_all[<span class="st">'Deck'</span>] <span class="op">=</span> df_all[<span class="st">'Cabin'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> s: s[<span class="dv">0</span>] <span class="cf">if</span> pd.notnull(s) <span class="cf">else</span> <span class="st">'M'</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>df_all_decks <span class="op">=</span> df_all.groupby([<span class="st">'Deck'</span>, <span class="st">'Pclass'</span>]).count().drop(columns<span class="op">=</span>[<span class="st">'Survived'</span>, <span class="st">'Sex'</span>, <span class="st">'Age'</span>, <span class="st">'SibSp'</span>, <span class="st">'Parch'</span>, </span>
<span id="cb17-5"><a href="#cb17-5"></a>                                                                        <span class="st">'Fare'</span>, <span class="st">'Embarked'</span>, <span class="st">'Cabin'</span>, <span class="st">'PassengerId'</span>, <span class="st">'Ticket'</span>]).rename(columns<span class="op">=</span>{<span class="st">'Name'</span>: <span class="st">'Count'</span>}).transpose()</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="kw">def</span> get_pclass_dist(df):</span>
<span id="cb17-8"><a href="#cb17-8"></a>    </span>
<span id="cb17-9"><a href="#cb17-9"></a>    <span class="co"># Creating a dictionary for every passenger class count in every deck</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>    deck_counts <span class="op">=</span> {<span class="st">'A'</span>: {}, <span class="st">'B'</span>: {}, <span class="st">'C'</span>: {}, <span class="st">'D'</span>: {}, <span class="st">'E'</span>: {}, <span class="st">'F'</span>: {}, <span class="st">'G'</span>: {}, <span class="st">'M'</span>: {}, <span class="st">'T'</span>: {}}</span>
<span id="cb17-11"><a href="#cb17-11"></a>    decks <span class="op">=</span> df.columns.levels[<span class="dv">0</span>]    </span>
<span id="cb17-12"><a href="#cb17-12"></a>    </span>
<span id="cb17-13"><a href="#cb17-13"></a>    <span class="cf">for</span> deck <span class="kw">in</span> decks:</span>
<span id="cb17-14"><a href="#cb17-14"></a>        <span class="cf">for</span> pclass <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span>):</span>
<span id="cb17-15"><a href="#cb17-15"></a>            <span class="cf">try</span>:</span>
<span id="cb17-16"><a href="#cb17-16"></a>                count <span class="op">=</span> df[deck][pclass][<span class="dv">0</span>]</span>
<span id="cb17-17"><a href="#cb17-17"></a>                deck_counts[deck][pclass] <span class="op">=</span> count </span>
<span id="cb17-18"><a href="#cb17-18"></a>            <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb17-19"><a href="#cb17-19"></a>                deck_counts[deck][pclass] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>                </span>
<span id="cb17-21"><a href="#cb17-21"></a>    df_decks <span class="op">=</span> pd.DataFrame(deck_counts)    </span>
<span id="cb17-22"><a href="#cb17-22"></a>    deck_percentages <span class="op">=</span> {}</span>
<span id="cb17-23"><a href="#cb17-23"></a></span>
<span id="cb17-24"><a href="#cb17-24"></a>    <span class="co"># Creating a dictionary for every passenger class percentage in every deck</span></span>
<span id="cb17-25"><a href="#cb17-25"></a>    <span class="cf">for</span> col <span class="kw">in</span> df_decks.columns:</span>
<span id="cb17-26"><a href="#cb17-26"></a>        deck_percentages[col] <span class="op">=</span> [(count <span class="op">/</span> df_decks[col].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> count <span class="kw">in</span> df_decks[col]]</span>
<span id="cb17-27"><a href="#cb17-27"></a>        </span>
<span id="cb17-28"><a href="#cb17-28"></a>    <span class="cf">return</span> deck_counts, deck_percentages</span>
<span id="cb17-29"><a href="#cb17-29"></a></span>
<span id="cb17-30"><a href="#cb17-30"></a><span class="kw">def</span> display_pclass_dist(percentages):</span>
<span id="cb17-31"><a href="#cb17-31"></a>    </span>
<span id="cb17-32"><a href="#cb17-32"></a>    df_percentages <span class="op">=</span> pd.DataFrame(percentages).transpose()</span>
<span id="cb17-33"><a href="#cb17-33"></a>    deck_names <span class="op">=</span> (<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'D'</span>, <span class="st">'E'</span>, <span class="st">'F'</span>, <span class="st">'G'</span>, <span class="st">'M'</span>, <span class="st">'T'</span>)</span>
<span id="cb17-34"><a href="#cb17-34"></a>    bar_count <span class="op">=</span> np.arange(<span class="bu">len</span>(deck_names))  </span>
<span id="cb17-35"><a href="#cb17-35"></a>    bar_width <span class="op">=</span> <span class="fl">0.85</span></span>
<span id="cb17-36"><a href="#cb17-36"></a>    </span>
<span id="cb17-37"><a href="#cb17-37"></a>    pclass1 <span class="op">=</span> df_percentages[<span class="dv">0</span>]</span>
<span id="cb17-38"><a href="#cb17-38"></a>    pclass2 <span class="op">=</span> df_percentages[<span class="dv">1</span>]</span>
<span id="cb17-39"><a href="#cb17-39"></a>    pclass3 <span class="op">=</span> df_percentages[<span class="dv">2</span>]</span>
<span id="cb17-40"><a href="#cb17-40"></a>    </span>
<span id="cb17-41"><a href="#cb17-41"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb17-42"><a href="#cb17-42"></a>    plt.bar(bar_count, pclass1, color<span class="op">=</span><span class="st">'#b5ffb9'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span>bar_width, label<span class="op">=</span><span class="st">'Passenger Class 1'</span>)</span>
<span id="cb17-43"><a href="#cb17-43"></a>    plt.bar(bar_count, pclass2, bottom<span class="op">=</span>pclass1, color<span class="op">=</span><span class="st">'#f9bc86'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span>bar_width, label<span class="op">=</span><span class="st">'Passenger Class 2'</span>)</span>
<span id="cb17-44"><a href="#cb17-44"></a>    plt.bar(bar_count, pclass3, bottom<span class="op">=</span>pclass1 <span class="op">+</span> pclass2, color<span class="op">=</span><span class="st">'#a3acff'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span>bar_width, label<span class="op">=</span><span class="st">'Passenger Class 3'</span>)</span>
<span id="cb17-45"><a href="#cb17-45"></a></span>
<span id="cb17-46"><a href="#cb17-46"></a>    plt.xlabel(<span class="st">'Deck'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb17-47"><a href="#cb17-47"></a>    plt.ylabel(<span class="st">'Passenger Class Percentage'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb17-48"><a href="#cb17-48"></a>    plt.xticks(bar_count, deck_names)    </span>
<span id="cb17-49"><a href="#cb17-49"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb17-50"><a href="#cb17-50"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb17-51"><a href="#cb17-51"></a>    </span>
<span id="cb17-52"><a href="#cb17-52"></a>    plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb17-53"><a href="#cb17-53"></a>    plt.title(<span class="st">'Passenger Class Distribution in Decks'</span>, size<span class="op">=</span><span class="dv">18</span>, y<span class="op">=</span><span class="fl">1.05</span>)   </span>
<span id="cb17-54"><a href="#cb17-54"></a>    </span>
<span id="cb17-55"><a href="#cb17-55"></a>    plt.show()    </span>
<span id="cb17-56"><a href="#cb17-56"></a></span>
<span id="cb17-57"><a href="#cb17-57"></a>all_deck_count, all_deck_per <span class="op">=</span> get_pclass_dist(df_all_decks)</span>
<span id="cb17-58"><a href="#cb17-58"></a>display_pclass_dist(all_deck_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
<ul>
<li><strong>100%</strong> of <strong>A</strong>, <strong>B</strong> and <strong>C</strong> decks are 1st class passengers</li>
<li>Deck <strong>D</strong> has <strong>87%</strong> 1st class and <strong>13%</strong> 2nd class passengers</li>
<li>Deck <strong>E</strong> has <strong>83%</strong> 1st class, <strong>10%</strong> 2nd class and <strong>7%</strong> 3rd class passengers</li>
<li>Deck <strong>F</strong> has <strong>62%</strong> 2nd class and <strong>38%</strong> 3rd class passengers</li>
<li><strong>100%</strong> of <strong>G</strong> deck are 3rd class passengers</li>
<li>There is one person on the boat deck in <strong>T</strong> cabin and he is a 1st class passenger. <strong>T</strong> cabin passenger has the closest resemblance to <strong>A</strong> deck passengers so he is grouped with <strong>A</strong> deck</li>
<li>Passengers labeled as <strong>M</strong> are the missing values in <code>Cabin</code> feature. I don’t think it is possible to find those passengers’ real <code>Deck</code> so I decided to use <strong>M</strong> like a deck</li>
</ul>
<div id="cell-25" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Passenger in the T deck is changed to A</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>idx <span class="op">=</span> df_all[df_all[<span class="st">'Deck'</span>] <span class="op">==</span> <span class="st">'T'</span>].index</span>
<span id="cb18-3"><a href="#cb18-3"></a>df_all.loc[idx, <span class="st">'Deck'</span>] <span class="op">=</span> <span class="st">'A'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {#cell-26 .cell _kg_hide-input=‘true’ execution_count=14}</p>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>df_all_decks_survived <span class="op">=</span> df_all.groupby([<span class="st">'Deck'</span>, <span class="st">'Survived'</span>]).count().drop(columns<span class="op">=</span>[<span class="st">'Sex'</span>, <span class="st">'Age'</span>, <span class="st">'SibSp'</span>, <span class="st">'Parch'</span>, <span class="st">'Fare'</span>, </span>
<span id="cb19-2"><a href="#cb19-2"></a>                                                                                   <span class="st">'Embarked'</span>, <span class="st">'Pclass'</span>, <span class="st">'Cabin'</span>, <span class="st">'PassengerId'</span>, <span class="st">'Ticket'</span>]).rename(columns<span class="op">=</span>{<span class="st">'Name'</span>:<span class="st">'Count'</span>}).transpose()</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="kw">def</span> get_survived_dist(df):</span>
<span id="cb19-5"><a href="#cb19-5"></a>    </span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="co"># Creating a dictionary for every survival count in every deck</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>    surv_counts <span class="op">=</span> {<span class="st">'A'</span>:{}, <span class="st">'B'</span>:{}, <span class="st">'C'</span>:{}, <span class="st">'D'</span>:{}, <span class="st">'E'</span>:{}, <span class="st">'F'</span>:{}, <span class="st">'G'</span>:{}, <span class="st">'M'</span>:{}}</span>
<span id="cb19-8"><a href="#cb19-8"></a>    decks <span class="op">=</span> df.columns.levels[<span class="dv">0</span>]    </span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="cf">for</span> deck <span class="kw">in</span> decks:</span>
<span id="cb19-11"><a href="#cb19-11"></a>        <span class="cf">for</span> survive <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">2</span>):</span>
<span id="cb19-12"><a href="#cb19-12"></a>            surv_counts[deck][survive] <span class="op">=</span> df[deck][survive][<span class="dv">0</span>]</span>
<span id="cb19-13"><a href="#cb19-13"></a>            </span>
<span id="cb19-14"><a href="#cb19-14"></a>    df_surv <span class="op">=</span> pd.DataFrame(surv_counts)</span>
<span id="cb19-15"><a href="#cb19-15"></a>    surv_percentages <span class="op">=</span> {}</span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="cf">for</span> col <span class="kw">in</span> df_surv.columns:</span>
<span id="cb19-18"><a href="#cb19-18"></a>        surv_percentages[col] <span class="op">=</span> [(count <span class="op">/</span> df_surv[col].<span class="bu">sum</span>()) <span class="op">*</span> <span class="dv">100</span> <span class="cf">for</span> count <span class="kw">in</span> df_surv[col]]</span>
<span id="cb19-19"><a href="#cb19-19"></a>        </span>
<span id="cb19-20"><a href="#cb19-20"></a>    <span class="cf">return</span> surv_counts, surv_percentages</span>
<span id="cb19-21"><a href="#cb19-21"></a></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="kw">def</span> display_surv_dist(percentages):</span>
<span id="cb19-23"><a href="#cb19-23"></a>    </span>
<span id="cb19-24"><a href="#cb19-24"></a>    df_survived_percentages <span class="op">=</span> pd.DataFrame(percentages).transpose()</span>
<span id="cb19-25"><a href="#cb19-25"></a>    deck_names <span class="op">=</span> (<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'D'</span>, <span class="st">'E'</span>, <span class="st">'F'</span>, <span class="st">'G'</span>, <span class="st">'M'</span>)</span>
<span id="cb19-26"><a href="#cb19-26"></a>    bar_count <span class="op">=</span> np.arange(<span class="bu">len</span>(deck_names))  </span>
<span id="cb19-27"><a href="#cb19-27"></a>    bar_width <span class="op">=</span> <span class="fl">0.85</span>    </span>
<span id="cb19-28"><a href="#cb19-28"></a></span>
<span id="cb19-29"><a href="#cb19-29"></a>    not_survived <span class="op">=</span> df_survived_percentages[<span class="dv">0</span>]</span>
<span id="cb19-30"><a href="#cb19-30"></a>    survived <span class="op">=</span> df_survived_percentages[<span class="dv">1</span>]</span>
<span id="cb19-31"><a href="#cb19-31"></a>    </span>
<span id="cb19-32"><a href="#cb19-32"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb19-33"><a href="#cb19-33"></a>    plt.bar(bar_count, not_survived, color<span class="op">=</span><span class="st">'#b5ffb9'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span>bar_width, label<span class="op">=</span><span class="st">"Not Survived"</span>)</span>
<span id="cb19-34"><a href="#cb19-34"></a>    plt.bar(bar_count, survived, bottom<span class="op">=</span>not_survived, color<span class="op">=</span><span class="st">'#f9bc86'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, width<span class="op">=</span>bar_width, label<span class="op">=</span><span class="st">"Survived"</span>)</span>
<span id="cb19-35"><a href="#cb19-35"></a> </span>
<span id="cb19-36"><a href="#cb19-36"></a>    plt.xlabel(<span class="st">'Deck'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb19-37"><a href="#cb19-37"></a>    plt.ylabel(<span class="st">'Survival Percentage'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb19-38"><a href="#cb19-38"></a>    plt.xticks(bar_count, deck_names)    </span>
<span id="cb19-39"><a href="#cb19-39"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb19-40"><a href="#cb19-40"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb19-41"><a href="#cb19-41"></a>    </span>
<span id="cb19-42"><a href="#cb19-42"></a>    plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb19-43"><a href="#cb19-43"></a>    plt.title(<span class="st">'Survival Percentage in Decks'</span>, size<span class="op">=</span><span class="dv">18</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb19-44"><a href="#cb19-44"></a>    </span>
<span id="cb19-45"><a href="#cb19-45"></a>    plt.show()</span>
<span id="cb19-46"><a href="#cb19-46"></a></span>
<span id="cb19-47"><a href="#cb19-47"></a>all_surv_count, all_surv_per <span class="op">=</span> get_survived_dist(df_all_decks_survived)</span>
<span id="cb19-48"><a href="#cb19-48"></a>display_surv_dist(all_surv_per)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
<p>As I suspected, every deck has different survival rates and that information can’t be discarded. Deck <strong>B</strong>, <strong>C</strong>, <strong>D</strong> and <strong>E</strong> have the highest survival rates. Those decks are mostly occupied by 1st class passengers. <strong>M</strong> has the lowest survival rate which is mostly occupied by 2nd and 3rd class passengers. To conclude, cabins used by 1st class passengers have higher survival rates than cabins used by 2nd and 3rd class passengers. In my opinion <strong>M</strong> (Missing <code>Cabin</code> values) has the lowest survival rate because they couldn’t retrieve the cabin data of the victims. That’s why I believe labeling that group as <strong>M</strong> is a reasonable way to handle the missing data. It is a unique group with shared characteristics. <code>Deck</code> feature has high-cardinality right now so some of the values are grouped with each other based on their similarities. * <strong>A</strong>, <strong>B</strong> and <strong>C</strong> decks are labeled as <strong>ABC</strong> because all of them have only 1st class passengers * <strong>D</strong> and <strong>E</strong> decks are labeled as <strong>DE</strong> because both of them have similar passenger class distribution and same survival rate * <strong>F</strong> and <strong>G</strong> decks are labeled as <strong>FG</strong> because of the same reason above * <strong>M</strong> deck doesn’t need to be grouped with other decks because it is very different from others and has the lowest survival rate.</p>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>df_all[<span class="st">'Deck'</span>] <span class="op">=</span> df_all[<span class="st">'Deck'</span>].replace([<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>], <span class="st">'ABC'</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>df_all[<span class="st">'Deck'</span>] <span class="op">=</span> df_all[<span class="st">'Deck'</span>].replace([<span class="st">'D'</span>, <span class="st">'E'</span>], <span class="st">'DE'</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a>df_all[<span class="st">'Deck'</span>] <span class="op">=</span> df_all[<span class="st">'Deck'</span>].replace([<span class="st">'F'</span>, <span class="st">'G'</span>], <span class="st">'FG'</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>df_all[<span class="st">'Deck'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>M      1014
ABC     182
DE       87
FG       26
Name: Deck, dtype: int64</code></pre>
</div>
</div>
<p>After filling the missing values in <code>Age</code>, <code>Embarked</code>, <code>Fare</code> and <code>Deck</code> features, there is no missing value left in both training and test set. <code>Cabin</code> is dropped because <code>Deck</code> feature is used instead of it.</p>
<p>::: {#cell-30 .cell _kg_hide-input=‘true’ execution_count=16}</p>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Dropping the Cabin feature</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>df_all.drop([<span class="st">'Cabin'</span>], inplace<span class="op">=</span><span class="va">True</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>df_train, df_test <span class="op">=</span> divide_df(df_all)</span>
<span id="cb22-5"><a href="#cb22-5"></a>dfs <span class="op">=</span> [df_train, df_test]</span>
<span id="cb22-6"><a href="#cb22-6"></a></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="cf">for</span> df <span class="kw">in</span> dfs:</span>
<span id="cb22-8"><a href="#cb22-8"></a>    display_missing(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Age column missing values: 0
Embarked column missing values: 0
Fare column missing values: 0
Name column missing values: 0
Parch column missing values: 0
PassengerId column missing values: 0
Pclass column missing values: 0
Sex column missing values: 0
SibSp column missing values: 0
Survived column missing values: 0
Ticket column missing values: 0
Deck column missing values: 0


Age column missing values: 0
Embarked column missing values: 0
Fare column missing values: 0
Name column missing values: 0
Parch column missing values: 0
PassengerId column missing values: 0
Pclass column missing values: 0
Sex column missing values: 0
SibSp column missing values: 0
Ticket column missing values: 0
Deck column missing values: 0

</code></pre>
</div>
<p>:::</p>
</section>
</section>
<section id="target-distribution" class="level3">
<h3 class="anchored" data-anchor-id="target-distribution"><strong>1.3 Target Distribution</strong></h3>
<ul>
<li><strong>38.38%</strong> (342/891) of training set is <strong>Class 1</strong></li>
<li><strong>61.62%</strong> (549/891) of training set is <strong>Class 0</strong></li>
</ul>
<p>::: {#cell-32 .cell _kg_hide-input=‘true’ _uuid=‘c70aa13b7a552beb976574d52c1cd3da1cc1ee5c’ execution_count=17}</p>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>survived <span class="op">=</span> df_train[<span class="st">'Survived'</span>].value_counts()[<span class="dv">1</span>]</span>
<span id="cb24-2"><a href="#cb24-2"></a>not_survived <span class="op">=</span> df_train[<span class="st">'Survived'</span>].value_counts()[<span class="dv">0</span>]</span>
<span id="cb24-3"><a href="#cb24-3"></a>survived_per <span class="op">=</span> survived <span class="op">/</span> df_train.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>not_survived_per <span class="op">=</span> not_survived <span class="op">/</span> df_train.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> of </span><span class="sc">{}</span><span class="st"> passengers survived and it is the </span><span class="sc">{:.2f}% o</span><span class="st">f the training set.'</span>.<span class="bu">format</span>(survived, df_train.shape[<span class="dv">0</span>], survived_per))</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> of </span><span class="sc">{}</span><span class="st"> passengers didnt survive and it is the </span><span class="sc">{:.2f}% o</span><span class="st">f the training set.'</span>.<span class="bu">format</span>(not_survived, df_train.shape[<span class="dv">0</span>], not_survived_per))</span>
<span id="cb24-8"><a href="#cb24-8"></a></span>
<span id="cb24-9"><a href="#cb24-9"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb24-10"><a href="#cb24-10"></a>sns.countplot(df_train[<span class="st">'Survived'</span>])</span>
<span id="cb24-11"><a href="#cb24-11"></a></span>
<span id="cb24-12"><a href="#cb24-12"></a>plt.xlabel(<span class="st">'Survival'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb24-13"><a href="#cb24-13"></a>plt.ylabel(<span class="st">'Passenger Count'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb24-14"><a href="#cb24-14"></a>plt.xticks((<span class="dv">0</span>, <span class="dv">1</span>), [<span class="st">'Not Survived (</span><span class="sc">{0:.2f}</span><span class="st">%)'</span>.<span class="bu">format</span>(not_survived_per), <span class="st">'Survived (</span><span class="sc">{0:.2f}</span><span class="st">%)'</span>.<span class="bu">format</span>(survived_per)])</span>
<span id="cb24-15"><a href="#cb24-15"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb24-16"><a href="#cb24-16"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb24-17"><a href="#cb24-17"></a></span>
<span id="cb24-18"><a href="#cb24-18"></a>plt.title(<span class="st">'Training Set Survival Distribution'</span>, size<span class="op">=</span><span class="dv">15</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb24-19"><a href="#cb24-19"></a></span>
<span id="cb24-20"><a href="#cb24-20"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>342 of 891 passengers survived and it is the 38.38% of the training set.
549 of 891 passengers didnt survive and it is the 61.62% of the training set.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="correlations" class="level3">
<h3 class="anchored" data-anchor-id="correlations"><strong>1.4 Correlations</strong></h3>
<p>Features are highly correlated with each other and dependent to each other. The highest correlation between features is <strong>0.549500</strong> in training set and <strong>0.577147</strong> in test set (between <code>Fare</code> and <code>Pclass</code>). The other features are also highly correlated. There are <strong>9</strong> correlations in training set and <strong>6</strong> correlations in test set that are higher than <strong>0.1</strong>.</p>
<p>::: {#cell-34 .cell _kg_hide-input=‘true’ execution_count=18}</p>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>df_train_corr <span class="op">=</span> df_train.drop([<span class="st">'PassengerId'</span>], axis<span class="op">=</span><span class="dv">1</span>).corr().<span class="bu">abs</span>().unstack().sort_values(kind<span class="op">=</span><span class="st">"quicksort"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb26-2"><a href="#cb26-2"></a>df_train_corr.rename(columns<span class="op">=</span>{<span class="st">"level_0"</span>: <span class="st">"Feature 1"</span>, <span class="st">"level_1"</span>: <span class="st">"Feature 2"</span>, <span class="dv">0</span>: <span class="st">'Correlation Coefficient'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>df_train_corr.drop(df_train_corr.iloc[<span class="dv">1</span>::<span class="dv">2</span>].index, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>df_train_corr_nd <span class="op">=</span> df_train_corr.drop(df_train_corr[df_train_corr[<span class="st">'Correlation Coefficient'</span>] <span class="op">==</span> <span class="fl">1.0</span>].index)</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a>df_test_corr <span class="op">=</span> df_test.corr().<span class="bu">abs</span>().unstack().sort_values(kind<span class="op">=</span><span class="st">"quicksort"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb26-7"><a href="#cb26-7"></a>df_test_corr.rename(columns<span class="op">=</span>{<span class="st">"level_0"</span>: <span class="st">"Feature 1"</span>, <span class="st">"level_1"</span>: <span class="st">"Feature 2"</span>, <span class="dv">0</span>: <span class="st">'Correlation Coefficient'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a>df_test_corr.drop(df_test_corr.iloc[<span class="dv">1</span>::<span class="dv">2</span>].index, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-9"><a href="#cb26-9"></a>df_test_corr_nd <span class="op">=</span> df_test_corr.drop(df_test_corr[df_test_corr[<span class="st">'Correlation Coefficient'</span>] <span class="op">==</span> <span class="fl">1.0</span>].index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<div id="cell-35" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Training set high correlations</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>corr <span class="op">=</span> df_train_corr_nd[<span class="st">'Correlation Coefficient'</span>] <span class="op">&gt;</span> <span class="fl">0.1</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>df_train_corr_nd[corr]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature 1</th>
<th data-quarto-table-cell-role="th">Feature 2</th>
<th data-quarto-table-cell-role="th">Correlation Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Fare</td>
<td>Pclass</td>
<td>0.549500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Age</td>
<td>Pclass</td>
<td>0.417667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Parch</td>
<td>SibSp</td>
<td>0.414838</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>Pclass</td>
<td>Survived</td>
<td>0.338481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Fare</td>
<td>Survived</td>
<td>0.257307</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Age</td>
<td>SibSp</td>
<td>0.249747</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Parch</td>
<td>Fare</td>
<td>0.216225</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>Parch</td>
<td>Age</td>
<td>0.176733</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SibSp</td>
<td>Fare</td>
<td>0.159651</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Age</td>
<td>Fare</td>
<td>0.124061</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Test set high correlations</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>corr <span class="op">=</span> df_test_corr_nd[<span class="st">'Correlation Coefficient'</span>] <span class="op">&gt;</span> <span class="fl">0.1</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>df_test_corr_nd[corr]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature 1</th>
<th data-quarto-table-cell-role="th">Feature 2</th>
<th data-quarto-table-cell-role="th">Correlation Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Pclass</td>
<td>Fare</td>
<td>0.577489</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Age</td>
<td>Pclass</td>
<td>0.526789</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Age</td>
<td>Fare</td>
<td>0.345347</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>SibSp</td>
<td>Parch</td>
<td>0.306895</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Parch</td>
<td>Fare</td>
<td>0.230410</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Fare</td>
<td>SibSp</td>
<td>0.172032</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>::: {#cell-37 .cell _kg_hide-input=‘true’ execution_count=21}</p>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a>sns.heatmap(df_train.drop([<span class="st">'PassengerId'</span>], axis<span class="op">=</span><span class="dv">1</span>).corr(), ax<span class="op">=</span>axs[<span class="dv">0</span>], annot<span class="op">=</span><span class="va">True</span>, square<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, annot_kws<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">14</span>})</span>
<span id="cb29-4"><a href="#cb29-4"></a>sns.heatmap(df_test.drop([<span class="st">'PassengerId'</span>], axis<span class="op">=</span><span class="dv">1</span>).corr(), ax<span class="op">=</span>axs[<span class="dv">1</span>], annot<span class="op">=</span><span class="va">True</span>, square<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, annot_kws<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">14</span>})</span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):    </span>
<span id="cb29-7"><a href="#cb29-7"></a>    axs[i].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-8"><a href="#cb29-8"></a>    axs[i].tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-9"><a href="#cb29-9"></a>    </span>
<span id="cb29-10"><a href="#cb29-10"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Training Set Correlations'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb29-11"><a href="#cb29-11"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Test Set Correlations'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="target-distribution-in-features" class="level3">
<h3 class="anchored" data-anchor-id="target-distribution-in-features"><strong>1.5 Target Distribution in Features</strong></h3>
<section id="continuous-features" class="level4">
<h4 class="anchored" data-anchor-id="continuous-features"><strong>1.5.1 Continuous Features</strong></h4>
<p>Both of the continuous features (<code>Age</code> and <code>Fare</code>) have good split points and spikes for a decision tree to learn. One potential problem for both features is, the distribution has more spikes and bumps in training set, but it is smoother in test set. Model may not be able to generalize to test set because of this reason.</p>
<ul>
<li>Distribution of <code>Age</code> feature clearly shows that children younger than 15 has a higher survival rate than any of the other age groups</li>
<li>In distribution of <code>Fare</code> feature, the survival rate is higher on distribution tails. The distribution also has positive skew because of the extremely large outliers</li>
</ul>
<p>::: {#cell-40 .cell _kg_hide-input=‘true’ execution_count=22}</p>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>cont_features <span class="op">=</span> [<span class="st">'Age'</span>, <span class="st">'Fare'</span>]</span>
<span id="cb30-2"><a href="#cb30-2"></a>surv <span class="op">=</span> df_train[<span class="st">'Survived'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb30-5"><a href="#cb30-5"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(cont_features):    </span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="co"># Distribution of survival in feature</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>    sns.distplot(df_train[<span class="op">~</span>surv][feature], label<span class="op">=</span><span class="st">'Not Survived'</span>, hist<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>][i])</span>
<span id="cb30-10"><a href="#cb30-10"></a>    sns.distplot(df_train[surv][feature], label<span class="op">=</span><span class="st">'Survived'</span>, hist<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'#2ecc71'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>][i])</span>
<span id="cb30-11"><a href="#cb30-11"></a>    </span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="co"># Distribution of feature in dataset</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>    sns.distplot(df_train[feature], label<span class="op">=</span><span class="st">'Training Set'</span>, hist<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>][i])</span>
<span id="cb30-14"><a href="#cb30-14"></a>    sns.distplot(df_test[feature], label<span class="op">=</span><span class="st">'Test Set'</span>, hist<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'#2ecc71'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>][i])</span>
<span id="cb30-15"><a href="#cb30-15"></a>    </span>
<span id="cb30-16"><a href="#cb30-16"></a>    axs[<span class="dv">0</span>][i].set_xlabel(<span class="st">''</span>)</span>
<span id="cb30-17"><a href="#cb30-17"></a>    axs[<span class="dv">1</span>][i].set_xlabel(<span class="st">''</span>)</span>
<span id="cb30-18"><a href="#cb30-18"></a>    </span>
<span id="cb30-19"><a href="#cb30-19"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):        </span>
<span id="cb30-20"><a href="#cb30-20"></a>        axs[i][j].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-21"><a href="#cb30-21"></a>        axs[i][j].tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-22"><a href="#cb30-22"></a>    </span>
<span id="cb30-23"><a href="#cb30-23"></a>    axs[<span class="dv">0</span>][i].legend(loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">20</span>})</span>
<span id="cb30-24"><a href="#cb30-24"></a>    axs[<span class="dv">1</span>][i].legend(loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">20</span>})</span>
<span id="cb30-25"><a href="#cb30-25"></a>    axs[<span class="dv">0</span>][i].set_title(<span class="st">'Distribution of Survival in </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(feature), size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb30-26"><a href="#cb30-26"></a></span>
<span id="cb30-27"><a href="#cb30-27"></a>axs[<span class="dv">1</span>][<span class="dv">0</span>].set_title(<span class="st">'Distribution of </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(<span class="st">'Age'</span>), size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb30-28"><a href="#cb30-28"></a>axs[<span class="dv">1</span>][<span class="dv">1</span>].set_title(<span class="st">'Distribution of </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(<span class="st">'Fare'</span>), size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb30-29"><a href="#cb30-29"></a>        </span>
<span id="cb30-30"><a href="#cb30-30"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="categorical-features" class="level4">
<h4 class="anchored" data-anchor-id="categorical-features"><strong>1.5.2 Categorical Features</strong></h4>
<p>Every categorical feature has at least one class with high mortality rate. Those classes are very helpful to predict whether the passenger is a survivor or victim. Best categorical features are <code>Pclass</code> and <code>Sex</code> because they have the most homogenous distributions.</p>
<ul>
<li>Passengers boarded from <strong>Southampton</strong> has a lower survival rate unlike other ports. More than half of the passengers boarded from <strong>Cherbourg</strong> had survived. This observation could be related to <code>Pclass</code> feature</li>
<li><code>Parch</code> and <code>SibSp</code> features show that passengers with only one family member has a higher survival rate</li>
</ul>
<p>::: {#cell-42 .cell _kg_hide-input=‘true’ execution_count=23}</p>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>cat_features <span class="op">=</span> [<span class="st">'Embarked'</span>, <span class="st">'Parch'</span>, <span class="st">'Pclass'</span>, <span class="st">'Sex'</span>, <span class="st">'SibSp'</span>, <span class="st">'Deck'</span>]</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb31-4"><a href="#cb31-4"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">1.5</span>, top<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(cat_features, <span class="dv">1</span>):    </span>
<span id="cb31-7"><a href="#cb31-7"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">3</span>, i)</span>
<span id="cb31-8"><a href="#cb31-8"></a>    sns.countplot(x<span class="op">=</span>feature, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_train)</span>
<span id="cb31-9"><a href="#cb31-9"></a>    </span>
<span id="cb31-10"><a href="#cb31-10"></a>    plt.xlabel(<span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(feature), size<span class="op">=</span><span class="dv">20</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb31-11"><a href="#cb31-11"></a>    plt.ylabel(<span class="st">'Passenger Count'</span>, size<span class="op">=</span><span class="dv">20</span>, labelpad<span class="op">=</span><span class="dv">15</span>)    </span>
<span id="cb31-12"><a href="#cb31-12"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb31-13"><a href="#cb31-13"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb31-14"><a href="#cb31-14"></a>    </span>
<span id="cb31-15"><a href="#cb31-15"></a>    plt.legend([<span class="st">'Not Survived'</span>, <span class="st">'Survived'</span>], loc<span class="op">=</span><span class="st">'upper center'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">18</span>})</span>
<span id="cb31-16"><a href="#cb31-16"></a>    plt.title(<span class="st">'Count of Survival in </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(feature), size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion"><strong>1.6 Conclusion</strong></h3>
<p>Most of the features are correlated with each other. This relationship can be used to create new features with feature transformation and feature interaction. Target encoding could be very useful as well because of the high correlations with <code>Survived</code> feature.</p>
<p>Split points and spikes are visible in continuous features. They can be captured easily with a decision tree model, but linear models may not be able to spot them.</p>
<p>Categorical features have very distinct distributions with different survival rates. Those features can be one-hot encoded. Some of those features may be combined with each other to make new features.</p>
<p>Created a new feature called <code>Deck</code> and dropped <code>Cabin</code> feature at the <strong>Exploratory Data Analysis</strong> part.</p>
<p>::: {#cell-44 .cell _kg_hide-input=‘true’ execution_count=24}</p>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>df_all <span class="op">=</span> concat_df(df_train, df_test)</span>
<span id="cb32-2"><a href="#cb32-2"></a>df_all.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Deck</th>
<th data-quarto-table-cell-role="th">Embarked</th>
<th data-quarto-table-cell-role="th">Fare</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Parch</th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Pclass</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">SibSp</th>
<th data-quarto-table-cell-role="th">Survived</th>
<th data-quarto-table-cell-role="th">Ticket</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>22.0</td>
<td>M</td>
<td>S</td>
<td>7.2500</td>
<td>Braund, Mr. Owen Harris</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>male</td>
<td>1</td>
<td>0.0</td>
<td>A/5 21171</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>38.0</td>
<td>ABC</td>
<td>C</td>
<td>71.2833</td>
<td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>female</td>
<td>1</td>
<td>1.0</td>
<td>PC 17599</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>26.0</td>
<td>M</td>
<td>S</td>
<td>7.9250</td>
<td>Heikkinen, Miss. Laina</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>female</td>
<td>0</td>
<td>1.0</td>
<td>STON/O2. 3101282</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>35.0</td>
<td>ABC</td>
<td>S</td>
<td>53.1000</td>
<td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td>0</td>
<td>4</td>
<td>1</td>
<td>female</td>
<td>1</td>
<td>1.0</td>
<td>113803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>35.0</td>
<td>M</td>
<td>S</td>
<td>8.0500</td>
<td>Allen, Mr. William Henry</td>
<td>0</td>
<td>5</td>
<td>3</td>
<td>male</td>
<td>0</td>
<td>0.0</td>
<td>373450</td>
</tr>
</tbody>
</table>

</div>
</div>
<p>:::</p>
</section>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering"><strong>2. Feature Engineering</strong></h2>
<section id="binning-continuous-features" class="level3">
<h3 class="anchored" data-anchor-id="binning-continuous-features"><strong>2.1 Binning Continuous Features</strong></h3>
<section id="fare-1" class="level4">
<h4 class="anchored" data-anchor-id="fare-1"><strong>2.1.1 Fare</strong></h4>
<p><code>Fare</code> feature is positively skewed and survival rate is extremely high on the right end. <strong>13</strong> quantile based bins are used for <code>Fare</code> feature. Even though the bins are too much, they provide decent amount of information gain. The groups at the left side of the graph has the lowest survival rate and the groups at the right side of the graph has the highest survival rate. This high survival rate was not visible in the distribution graph. There is also an unusual group <strong>(15.742, 23.25]</strong> in the middle with high survival rate that is captured in this process.</p>
<div id="cell-48" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>df_all[<span class="st">'Fare'</span>] <span class="op">=</span> pd.qcut(df_all[<span class="st">'Fare'</span>], <span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {#cell-49 .cell _kg_hide-input=‘true’ execution_count=26}</p>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">9</span>))</span>
<span id="cb34-2"><a href="#cb34-2"></a>sns.countplot(x<span class="op">=</span><span class="st">'Fare'</span>, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_all)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a>plt.xlabel(<span class="st">'Fare'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a>plt.ylabel(<span class="st">'Passenger Count'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb34-6"><a href="#cb34-6"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb34-7"><a href="#cb34-7"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a></span>
<span id="cb34-9"><a href="#cb34-9"></a>plt.legend([<span class="st">'Not Survived'</span>, <span class="st">'Survived'</span>], loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb34-10"><a href="#cb34-10"></a>plt.title(<span class="st">'Count of Survival in </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(<span class="st">'Fare'</span>), size<span class="op">=</span><span class="dv">15</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb34-11"><a href="#cb34-11"></a></span>
<span id="cb34-12"><a href="#cb34-12"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="age-1" class="level4">
<h4 class="anchored" data-anchor-id="age-1"><strong>2.1.2 Age</strong></h4>
<p><code>Age</code> feature has a normal distribution with some spikes and bumps and <strong>10</strong> quantile based bins are used for <code>Age</code>. The first bin has the highest survival rate and 4th bin has the lowest survival rate. Those were the biggest spikes in the distribution. There is also an unusual group <strong>(34.0, 40.0]</strong> with high survival rate that is captured in this process.</p>
<div id="cell-51" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>df_all[<span class="st">'Age'</span>] <span class="op">=</span> pd.qcut(df_all[<span class="st">'Age'</span>], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {#cell-52 .cell _kg_hide-input=‘true’ execution_count=28}</p>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">22</span>, <span class="dv">9</span>))</span>
<span id="cb36-2"><a href="#cb36-2"></a>sns.countplot(x<span class="op">=</span><span class="st">'Age'</span>, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_all)</span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a>plt.xlabel(<span class="st">'Age'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a>plt.ylabel(<span class="st">'Passenger Count'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb36-6"><a href="#cb36-6"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb36-7"><a href="#cb36-7"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a>plt.legend([<span class="st">'Not Survived'</span>, <span class="st">'Survived'</span>], loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb36-10"><a href="#cb36-10"></a>plt.title(<span class="st">'Survival Counts in </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(<span class="st">'Age'</span>), size<span class="op">=</span><span class="dv">15</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb36-11"><a href="#cb36-11"></a></span>
<span id="cb36-12"><a href="#cb36-12"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
</section>
<section id="frequency-encoding" class="level3">
<h3 class="anchored" data-anchor-id="frequency-encoding"><strong>2.2 Frequency Encoding</strong></h3>
<p><code>Family_Size</code> is created by adding <code>SibSp</code>, <code>Parch</code> and <strong>1</strong>. <code>SibSp</code> is the count of siblings and spouse, and <code>Parch</code> is the count of parents and children. Those columns are added in order to find the total size of families. Adding <strong>1</strong> at the end, is the current passenger. Graphs have clearly shown that family size is a predictor of survival because different values have different survival rates. * Family Size with <strong>1</strong> are labeled as <strong>Alone</strong> * Family Size with <strong>2</strong>, <strong>3</strong> and <strong>4</strong> are labeled as <strong>Small</strong> * Family Size with <strong>5</strong> and <strong>6</strong> are labeled as <strong>Medium</strong> * Family Size with <strong>7</strong>, <strong>8</strong> and <strong>11</strong> are labeled as <strong>Large</strong></p>
<p>::: {#cell-54 .cell _kg_hide-input=‘true’ execution_count=29}</p>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>df_all[<span class="st">'Family_Size'</span>] <span class="op">=</span> df_all[<span class="st">'SibSp'</span>] <span class="op">+</span> df_all[<span class="st">'Parch'</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>), ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb37-4"><a href="#cb37-4"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a>sns.barplot(x<span class="op">=</span>df_all[<span class="st">'Family_Size'</span>].value_counts().index, y<span class="op">=</span>df_all[<span class="st">'Family_Size'</span>].value_counts().values, ax<span class="op">=</span>axs[<span class="dv">0</span>][<span class="dv">0</span>])</span>
<span id="cb37-7"><a href="#cb37-7"></a>sns.countplot(x<span class="op">=</span><span class="st">'Family_Size'</span>, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_all, ax<span class="op">=</span>axs[<span class="dv">0</span>][<span class="dv">1</span>])</span>
<span id="cb37-8"><a href="#cb37-8"></a></span>
<span id="cb37-9"><a href="#cb37-9"></a>axs[<span class="dv">0</span>][<span class="dv">0</span>].set_title(<span class="st">'Family Size Feature Value Counts'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb37-10"><a href="#cb37-10"></a>axs[<span class="dv">0</span>][<span class="dv">1</span>].set_title(<span class="st">'Survival Counts in Family Size '</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb37-11"><a href="#cb37-11"></a></span>
<span id="cb37-12"><a href="#cb37-12"></a>family_map <span class="op">=</span> {<span class="dv">1</span>: <span class="st">'Alone'</span>, <span class="dv">2</span>: <span class="st">'Small'</span>, <span class="dv">3</span>: <span class="st">'Small'</span>, <span class="dv">4</span>: <span class="st">'Small'</span>, <span class="dv">5</span>: <span class="st">'Medium'</span>, <span class="dv">6</span>: <span class="st">'Medium'</span>, <span class="dv">7</span>: <span class="st">'Large'</span>, <span class="dv">8</span>: <span class="st">'Large'</span>, <span class="dv">11</span>: <span class="st">'Large'</span>}</span>
<span id="cb37-13"><a href="#cb37-13"></a>df_all[<span class="st">'Family_Size_Grouped'</span>] <span class="op">=</span> df_all[<span class="st">'Family_Size'</span>].<span class="bu">map</span>(family_map)</span>
<span id="cb37-14"><a href="#cb37-14"></a></span>
<span id="cb37-15"><a href="#cb37-15"></a>sns.barplot(x<span class="op">=</span>df_all[<span class="st">'Family_Size_Grouped'</span>].value_counts().index, y<span class="op">=</span>df_all[<span class="st">'Family_Size_Grouped'</span>].value_counts().values, ax<span class="op">=</span>axs[<span class="dv">1</span>][<span class="dv">0</span>])</span>
<span id="cb37-16"><a href="#cb37-16"></a>sns.countplot(x<span class="op">=</span><span class="st">'Family_Size_Grouped'</span>, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_all, ax<span class="op">=</span>axs[<span class="dv">1</span>][<span class="dv">1</span>])</span>
<span id="cb37-17"><a href="#cb37-17"></a></span>
<span id="cb37-18"><a href="#cb37-18"></a>axs[<span class="dv">1</span>][<span class="dv">0</span>].set_title(<span class="st">'Family Size Feature Value Counts After Grouping'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb37-19"><a href="#cb37-19"></a>axs[<span class="dv">1</span>][<span class="dv">1</span>].set_title(<span class="st">'Survival Counts in Family Size After Grouping'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb37-20"><a href="#cb37-20"></a></span>
<span id="cb37-21"><a href="#cb37-21"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb37-22"><a href="#cb37-22"></a>    axs[i][<span class="dv">1</span>].legend([<span class="st">'Not Survived'</span>, <span class="st">'Survived'</span>], loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">20</span>})</span>
<span id="cb37-23"><a href="#cb37-23"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb37-24"><a href="#cb37-24"></a>        axs[i][j].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb37-25"><a href="#cb37-25"></a>        axs[i][j].tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb37-26"><a href="#cb37-26"></a>        axs[i][j].set_xlabel(<span class="st">''</span>)</span>
<span id="cb37-27"><a href="#cb37-27"></a>        axs[i][j].set_ylabel(<span class="st">''</span>)</span>
<span id="cb37-28"><a href="#cb37-28"></a></span>
<span id="cb37-29"><a href="#cb37-29"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
<p>There are too many unique <code>Ticket</code> values to analyze, so grouping them up by their frequencies makes things easier.</p>
<p><strong>How is this feature different than <code>Family_Size</code>?</strong> Many passengers travelled along with groups. Those groups consist of friends, nannies, maids and etc. They weren’t counted as family, but they used the same ticket.</p>
<p><strong>Why not grouping tickets by their prefixes?</strong> If prefixes in <code>Ticket</code> feature has any meaning, then they are already captured in <code>Pclass</code> or <code>Embarked</code> features because that could be the only logical information which can be derived from the <code>Ticket</code> feature.</p>
<p>According to the graph below, groups with <strong>2</strong>,<strong>3</strong> and <strong>4</strong> members had a higher survival rate. Passengers who travel alone has the lowest survival rate. After <strong>4</strong> group members, survival rate decreases drastically. This pattern is very similar to <code>Family_Size</code> feature but there are minor differences. <code>Ticket_Frequency</code> values are not grouped like <code>Family_Size</code> because that would basically create the same feature with perfect correlation. This kind of feature wouldn’t provide any additional information gain.</p>
<div id="cell-56" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>df_all[<span class="st">'Ticket_Frequency'</span>] <span class="op">=</span> df_all.groupby(<span class="st">'Ticket'</span>)[<span class="st">'Ticket'</span>].transform(<span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {#cell-57 .cell _kg_hide-input=‘true’ execution_count=31}</p>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>fig, axs <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">9</span>))</span>
<span id="cb39-2"><a href="#cb39-2"></a>sns.countplot(x<span class="op">=</span><span class="st">'Ticket_Frequency'</span>, hue<span class="op">=</span><span class="st">'Survived'</span>, data<span class="op">=</span>df_all)</span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a>plt.xlabel(<span class="st">'Ticket Frequency'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a>plt.ylabel(<span class="st">'Passenger Count'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-7"><a href="#cb39-7"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>plt.legend([<span class="st">'Not Survived'</span>, <span class="st">'Survived'</span>], loc<span class="op">=</span><span class="st">'upper right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb39-10"><a href="#cb39-10"></a>plt.title(<span class="st">'Count of Survival in </span><span class="sc">{}</span><span class="st"> Feature'</span>.<span class="bu">format</span>(<span class="st">'Ticket Frequency'</span>), size<span class="op">=</span><span class="dv">15</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="title-is-married" class="level3">
<h3 class="anchored" data-anchor-id="title-is-married"><strong>2.3 Title &amp; Is Married</strong></h3>
<p><code>Title</code> is created by extracting the prefix before <code>Name</code> feature. According to graph below, there are many titles that are occuring very few times. Some of those titles doesn’t seem correct and they need to be replaced. <strong>Miss</strong>, <strong>Mrs</strong>, <strong>Ms</strong>, <strong>Mlle</strong>, <strong>Lady</strong>, <strong>Mme</strong>, <strong>the Countess</strong>, <strong>Dona</strong> titles are replaced with <strong>Miss/Mrs/Ms</strong> because all of them are female. Values like <strong>Mlle</strong>, <strong>Mme</strong> and <strong>Dona</strong> are actually the name of the passengers, but they are classified as titles because <code>Name</code> feature is split by comma. <strong>Dr</strong>, <strong>Col</strong>, <strong>Major</strong>, <strong>Jonkheer</strong>, <strong>Capt</strong>, <strong>Sir</strong>, <strong>Don</strong> and <strong>Rev</strong> titles are replaced with <strong>Dr/Military/Noble/Clergy</strong> because those passengers have similar characteristics. <strong>Master</strong> is a unique title. It is given to male passengers below age <strong>26</strong>. They have the highest survival rate among all males.</p>
<p><code>Is_Married</code> is a binary feature based on the <strong>Mrs</strong> title. <strong>Mrs</strong> title has the highest survival rate among other female titles. This title needs to be a feature because all female titles are grouped with each other.</p>
<div id="cell-59" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>df_all[<span class="st">'Title'</span>] <span class="op">=</span> df_all[<span class="st">'Name'</span>].<span class="bu">str</span>.split(<span class="st">', '</span>, expand<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>].<span class="bu">str</span>.split(<span class="st">'.'</span>, expand<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb40-2"><a href="#cb40-2"></a>df_all[<span class="st">'Is_Married'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>df_all[<span class="st">'Is_Married'</span>].loc[df_all[<span class="st">'Title'</span>] <span class="op">==</span> <span class="st">'Mrs'</span>] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {#cell-60 .cell _kg_hide-input=‘true’ execution_count=33}</p>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb41-2"><a href="#cb41-2"></a>sns.barplot(x<span class="op">=</span>df_all[<span class="st">'Title'</span>].value_counts().index, y<span class="op">=</span>df_all[<span class="st">'Title'</span>].value_counts().values, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a>axs[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb41-5"><a href="#cb41-5"></a>axs[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):    </span>
<span id="cb41-8"><a href="#cb41-8"></a>    axs[i].tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a></span>
<span id="cb41-10"><a href="#cb41-10"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Title Feature Value Counts'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb41-11"><a href="#cb41-11"></a></span>
<span id="cb41-12"><a href="#cb41-12"></a>df_all[<span class="st">'Title'</span>] <span class="op">=</span> df_all[<span class="st">'Title'</span>].replace([<span class="st">'Miss'</span>, <span class="st">'Mrs'</span>,<span class="st">'Ms'</span>, <span class="st">'Mlle'</span>, <span class="st">'Lady'</span>, <span class="st">'Mme'</span>, <span class="st">'the Countess'</span>, <span class="st">'Dona'</span>], <span class="st">'Miss/Mrs/Ms'</span>)</span>
<span id="cb41-13"><a href="#cb41-13"></a>df_all[<span class="st">'Title'</span>] <span class="op">=</span> df_all[<span class="st">'Title'</span>].replace([<span class="st">'Dr'</span>, <span class="st">'Col'</span>, <span class="st">'Major'</span>, <span class="st">'Jonkheer'</span>, <span class="st">'Capt'</span>, <span class="st">'Sir'</span>, <span class="st">'Don'</span>, <span class="st">'Rev'</span>], <span class="st">'Dr/Military/Noble/Clergy'</span>)</span>
<span id="cb41-14"><a href="#cb41-14"></a></span>
<span id="cb41-15"><a href="#cb41-15"></a>sns.barplot(x<span class="op">=</span>df_all[<span class="st">'Title'</span>].value_counts().index, y<span class="op">=</span>df_all[<span class="st">'Title'</span>].value_counts().values, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb41-16"><a href="#cb41-16"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Title Feature Value Counts After Grouping'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb41-17"><a href="#cb41-17"></a></span>
<span id="cb41-18"><a href="#cb41-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="target-encoding" class="level3">
<h3 class="anchored" data-anchor-id="target-encoding"><strong>2.4 Target Encoding</strong></h3>
<p><code>extract_surname</code> function is used for extracting surnames of passengers from the <code>Name</code> feature. <code>Family</code> feature is created with the extracted surname. This is necessary for grouping passengers in the same family.</p>
<div id="cell-62" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">def</span> extract_surname(data):    </span>
<span id="cb42-2"><a href="#cb42-2"></a>    </span>
<span id="cb42-3"><a href="#cb42-3"></a>    families <span class="op">=</span> []</span>
<span id="cb42-4"><a href="#cb42-4"></a>    </span>
<span id="cb42-5"><a href="#cb42-5"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):        </span>
<span id="cb42-6"><a href="#cb42-6"></a>        name <span class="op">=</span> data.iloc[i]</span>
<span id="cb42-7"><a href="#cb42-7"></a></span>
<span id="cb42-8"><a href="#cb42-8"></a>        <span class="cf">if</span> <span class="st">'('</span> <span class="kw">in</span> name:</span>
<span id="cb42-9"><a href="#cb42-9"></a>            name_no_bracket <span class="op">=</span> name.split(<span class="st">'('</span>)[<span class="dv">0</span>] </span>
<span id="cb42-10"><a href="#cb42-10"></a>        <span class="cf">else</span>:</span>
<span id="cb42-11"><a href="#cb42-11"></a>            name_no_bracket <span class="op">=</span> name</span>
<span id="cb42-12"><a href="#cb42-12"></a>            </span>
<span id="cb42-13"><a href="#cb42-13"></a>        family <span class="op">=</span> name_no_bracket.split(<span class="st">','</span>)[<span class="dv">0</span>]</span>
<span id="cb42-14"><a href="#cb42-14"></a>        title <span class="op">=</span> name_no_bracket.split(<span class="st">','</span>)[<span class="dv">1</span>].strip().split(<span class="st">' '</span>)[<span class="dv">0</span>]</span>
<span id="cb42-15"><a href="#cb42-15"></a>        </span>
<span id="cb42-16"><a href="#cb42-16"></a>        <span class="cf">for</span> c <span class="kw">in</span> string.punctuation:</span>
<span id="cb42-17"><a href="#cb42-17"></a>            family <span class="op">=</span> family.replace(c, <span class="st">''</span>).strip()</span>
<span id="cb42-18"><a href="#cb42-18"></a>            </span>
<span id="cb42-19"><a href="#cb42-19"></a>        families.append(family)</span>
<span id="cb42-20"><a href="#cb42-20"></a>            </span>
<span id="cb42-21"><a href="#cb42-21"></a>    <span class="cf">return</span> families</span>
<span id="cb42-22"><a href="#cb42-22"></a></span>
<span id="cb42-23"><a href="#cb42-23"></a>df_all[<span class="st">'Family'</span>] <span class="op">=</span> extract_surname(df_all[<span class="st">'Name'</span>])</span>
<span id="cb42-24"><a href="#cb42-24"></a>df_train <span class="op">=</span> df_all.loc[:<span class="dv">890</span>]</span>
<span id="cb42-25"><a href="#cb42-25"></a>df_test <span class="op">=</span> df_all.loc[<span class="dv">891</span>:]</span>
<span id="cb42-26"><a href="#cb42-26"></a>dfs <span class="op">=</span> [df_train, df_test]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Family_Survival_Rate</code> is calculated from families in training set since there is no <code>Survived</code> feature in test set. A list of family names that are occuring in both training and test set (<code>non_unique_families</code>), is created. The survival rate is calculated for families with more than 1 members in that list, and stored in <code>Family_Survival_Rate</code> feature.</p>
<p>An extra binary feature <code>Family_Survival_Rate_NA</code> is created for families that are unique to the test set. This feature is also necessary because there is no way to calculate those families’ survival rate. This feature implies that family survival rate is not applicable to those passengers because there is no way to retrieve their survival rate.</p>
<p><code>Ticket_Survival_Rate</code> and <code>Ticket_Survival_Rate_NA</code> features are also created with the same method. <code>Ticket_Survival_Rate</code> and <code>Family_Survival_Rate</code> are averaged and become <code>Survival_Rate</code>, and <code>Ticket_Survival_Rate_NA</code> and <code>Family_Survival_Rate_NA</code> are also averaged and become <code>Survival_Rate_NA</code>.</p>
<div id="cell-64" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Creating a list of families and tickets that are occuring in both training and test set</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>non_unique_families <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> df_train[<span class="st">'Family'</span>].unique() <span class="cf">if</span> x <span class="kw">in</span> df_test[<span class="st">'Family'</span>].unique()]</span>
<span id="cb43-3"><a href="#cb43-3"></a>non_unique_tickets <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> df_train[<span class="st">'Ticket'</span>].unique() <span class="cf">if</span> x <span class="kw">in</span> df_test[<span class="st">'Ticket'</span>].unique()]</span>
<span id="cb43-4"><a href="#cb43-4"></a></span>
<span id="cb43-5"><a href="#cb43-5"></a>df_family_survival_rate <span class="op">=</span> df_train.groupby(<span class="st">'Family'</span>)[<span class="st">'Survived'</span>, <span class="st">'Family'</span>,<span class="st">'Family_Size'</span>].median()</span>
<span id="cb43-6"><a href="#cb43-6"></a>df_ticket_survival_rate <span class="op">=</span> df_train.groupby(<span class="st">'Ticket'</span>)[<span class="st">'Survived'</span>, <span class="st">'Ticket'</span>,<span class="st">'Ticket_Frequency'</span>].median()</span>
<span id="cb43-7"><a href="#cb43-7"></a></span>
<span id="cb43-8"><a href="#cb43-8"></a>family_rates <span class="op">=</span> {}</span>
<span id="cb43-9"><a href="#cb43-9"></a>ticket_rates <span class="op">=</span> {}</span>
<span id="cb43-10"><a href="#cb43-10"></a></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_family_survival_rate)):</span>
<span id="cb43-12"><a href="#cb43-12"></a>    <span class="co"># Checking a family exists in both training and test set, and has members more than 1</span></span>
<span id="cb43-13"><a href="#cb43-13"></a>    <span class="cf">if</span> df_family_survival_rate.index[i] <span class="kw">in</span> non_unique_families <span class="kw">and</span> df_family_survival_rate.iloc[i, <span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb43-14"><a href="#cb43-14"></a>        family_rates[df_family_survival_rate.index[i]] <span class="op">=</span> df_family_survival_rate.iloc[i, <span class="dv">0</span>]</span>
<span id="cb43-15"><a href="#cb43-15"></a></span>
<span id="cb43-16"><a href="#cb43-16"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_ticket_survival_rate)):</span>
<span id="cb43-17"><a href="#cb43-17"></a>    <span class="co"># Checking a ticket exists in both training and test set, and has members more than 1</span></span>
<span id="cb43-18"><a href="#cb43-18"></a>    <span class="cf">if</span> df_ticket_survival_rate.index[i] <span class="kw">in</span> non_unique_tickets <span class="kw">and</span> df_ticket_survival_rate.iloc[i, <span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb43-19"><a href="#cb43-19"></a>        ticket_rates[df_ticket_survival_rate.index[i]] <span class="op">=</span> df_ticket_survival_rate.iloc[i, <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>mean_survival_rate <span class="op">=</span> np.mean(df_train[<span class="st">'Survived'</span>])</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a>train_family_survival_rate <span class="op">=</span> []</span>
<span id="cb44-4"><a href="#cb44-4"></a>train_family_survival_rate_NA <span class="op">=</span> []</span>
<span id="cb44-5"><a href="#cb44-5"></a>test_family_survival_rate <span class="op">=</span> []</span>
<span id="cb44-6"><a href="#cb44-6"></a>test_family_survival_rate_NA <span class="op">=</span> []</span>
<span id="cb44-7"><a href="#cb44-7"></a></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_train)):</span>
<span id="cb44-9"><a href="#cb44-9"></a>    <span class="cf">if</span> df_train[<span class="st">'Family'</span>][i] <span class="kw">in</span> family_rates:</span>
<span id="cb44-10"><a href="#cb44-10"></a>        train_family_survival_rate.append(family_rates[df_train[<span class="st">'Family'</span>][i]])</span>
<span id="cb44-11"><a href="#cb44-11"></a>        train_family_survival_rate_NA.append(<span class="dv">1</span>)</span>
<span id="cb44-12"><a href="#cb44-12"></a>    <span class="cf">else</span>:</span>
<span id="cb44-13"><a href="#cb44-13"></a>        train_family_survival_rate.append(mean_survival_rate)</span>
<span id="cb44-14"><a href="#cb44-14"></a>        train_family_survival_rate_NA.append(<span class="dv">0</span>)</span>
<span id="cb44-15"><a href="#cb44-15"></a>        </span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_test)):</span>
<span id="cb44-17"><a href="#cb44-17"></a>    <span class="cf">if</span> df_test[<span class="st">'Family'</span>].iloc[i] <span class="kw">in</span> family_rates:</span>
<span id="cb44-18"><a href="#cb44-18"></a>        test_family_survival_rate.append(family_rates[df_test[<span class="st">'Family'</span>].iloc[i]])</span>
<span id="cb44-19"><a href="#cb44-19"></a>        test_family_survival_rate_NA.append(<span class="dv">1</span>)</span>
<span id="cb44-20"><a href="#cb44-20"></a>    <span class="cf">else</span>:</span>
<span id="cb44-21"><a href="#cb44-21"></a>        test_family_survival_rate.append(mean_survival_rate)</span>
<span id="cb44-22"><a href="#cb44-22"></a>        test_family_survival_rate_NA.append(<span class="dv">0</span>)</span>
<span id="cb44-23"><a href="#cb44-23"></a>        </span>
<span id="cb44-24"><a href="#cb44-24"></a>df_train[<span class="st">'Family_Survival_Rate'</span>] <span class="op">=</span> train_family_survival_rate</span>
<span id="cb44-25"><a href="#cb44-25"></a>df_train[<span class="st">'Family_Survival_Rate_NA'</span>] <span class="op">=</span> train_family_survival_rate_NA</span>
<span id="cb44-26"><a href="#cb44-26"></a>df_test[<span class="st">'Family_Survival_Rate'</span>] <span class="op">=</span> test_family_survival_rate</span>
<span id="cb44-27"><a href="#cb44-27"></a>df_test[<span class="st">'Family_Survival_Rate_NA'</span>] <span class="op">=</span> test_family_survival_rate_NA</span>
<span id="cb44-28"><a href="#cb44-28"></a></span>
<span id="cb44-29"><a href="#cb44-29"></a>train_ticket_survival_rate <span class="op">=</span> []</span>
<span id="cb44-30"><a href="#cb44-30"></a>train_ticket_survival_rate_NA <span class="op">=</span> []</span>
<span id="cb44-31"><a href="#cb44-31"></a>test_ticket_survival_rate <span class="op">=</span> []</span>
<span id="cb44-32"><a href="#cb44-32"></a>test_ticket_survival_rate_NA <span class="op">=</span> []</span>
<span id="cb44-33"><a href="#cb44-33"></a></span>
<span id="cb44-34"><a href="#cb44-34"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_train)):</span>
<span id="cb44-35"><a href="#cb44-35"></a>    <span class="cf">if</span> df_train[<span class="st">'Ticket'</span>][i] <span class="kw">in</span> ticket_rates:</span>
<span id="cb44-36"><a href="#cb44-36"></a>        train_ticket_survival_rate.append(ticket_rates[df_train[<span class="st">'Ticket'</span>][i]])</span>
<span id="cb44-37"><a href="#cb44-37"></a>        train_ticket_survival_rate_NA.append(<span class="dv">1</span>)</span>
<span id="cb44-38"><a href="#cb44-38"></a>    <span class="cf">else</span>:</span>
<span id="cb44-39"><a href="#cb44-39"></a>        train_ticket_survival_rate.append(mean_survival_rate)</span>
<span id="cb44-40"><a href="#cb44-40"></a>        train_ticket_survival_rate_NA.append(<span class="dv">0</span>)</span>
<span id="cb44-41"><a href="#cb44-41"></a>        </span>
<span id="cb44-42"><a href="#cb44-42"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df_test)):</span>
<span id="cb44-43"><a href="#cb44-43"></a>    <span class="cf">if</span> df_test[<span class="st">'Ticket'</span>].iloc[i] <span class="kw">in</span> ticket_rates:</span>
<span id="cb44-44"><a href="#cb44-44"></a>        test_ticket_survival_rate.append(ticket_rates[df_test[<span class="st">'Ticket'</span>].iloc[i]])</span>
<span id="cb44-45"><a href="#cb44-45"></a>        test_ticket_survival_rate_NA.append(<span class="dv">1</span>)</span>
<span id="cb44-46"><a href="#cb44-46"></a>    <span class="cf">else</span>:</span>
<span id="cb44-47"><a href="#cb44-47"></a>        test_ticket_survival_rate.append(mean_survival_rate)</span>
<span id="cb44-48"><a href="#cb44-48"></a>        test_ticket_survival_rate_NA.append(<span class="dv">0</span>)</span>
<span id="cb44-49"><a href="#cb44-49"></a>        </span>
<span id="cb44-50"><a href="#cb44-50"></a>df_train[<span class="st">'Ticket_Survival_Rate'</span>] <span class="op">=</span> train_ticket_survival_rate</span>
<span id="cb44-51"><a href="#cb44-51"></a>df_train[<span class="st">'Ticket_Survival_Rate_NA'</span>] <span class="op">=</span> train_ticket_survival_rate_NA</span>
<span id="cb44-52"><a href="#cb44-52"></a>df_test[<span class="st">'Ticket_Survival_Rate'</span>] <span class="op">=</span> test_ticket_survival_rate</span>
<span id="cb44-53"><a href="#cb44-53"></a>df_test[<span class="st">'Ticket_Survival_Rate_NA'</span>] <span class="op">=</span> test_ticket_survival_rate_NA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-66" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="cf">for</span> df <span class="kw">in</span> [df_train, df_test]:</span>
<span id="cb45-2"><a href="#cb45-2"></a>    df[<span class="st">'Survival_Rate'</span>] <span class="op">=</span> (df[<span class="st">'Ticket_Survival_Rate'</span>] <span class="op">+</span> df[<span class="st">'Family_Survival_Rate'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>    df[<span class="st">'Survival_Rate_NA'</span>] <span class="op">=</span> (df[<span class="st">'Ticket_Survival_Rate_NA'</span>] <span class="op">+</span> df[<span class="st">'Family_Survival_Rate_NA'</span>]) <span class="op">/</span> <span class="dv">2</span>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-transformation" class="level3">
<h3 class="anchored" data-anchor-id="feature-transformation"><strong>2.5 Feature Transformation</strong></h3>
<section id="label-encoding-non-numerical-features" class="level4">
<h4 class="anchored" data-anchor-id="label-encoding-non-numerical-features"><strong>2.5.1 Label Encoding Non-Numerical Features</strong></h4>
<p><code>Embarked</code>, <code>Sex</code>, <code>Deck</code> , <code>Title</code> and <code>Family_Size_Grouped</code> are object type, and <code>Age</code> and <code>Fare</code> features are category type. They are converted to numerical type with <code>LabelEncoder</code>. <code>LabelEncoder</code> basically labels the classes from <strong>0</strong> to <strong>n</strong>. This process is necessary for models to learn from those features.</p>
<div id="cell-69" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>non_numeric_features <span class="op">=</span> [<span class="st">'Embarked'</span>, <span class="st">'Sex'</span>, <span class="st">'Deck'</span>, <span class="st">'Title'</span>, <span class="st">'Family_Size_Grouped'</span>, <span class="st">'Age'</span>, <span class="st">'Fare'</span>]</span>
<span id="cb46-2"><a href="#cb46-2"></a></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="cf">for</span> df <span class="kw">in</span> dfs:</span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="cf">for</span> feature <span class="kw">in</span> non_numeric_features:        </span>
<span id="cb46-5"><a href="#cb46-5"></a>        df[feature] <span class="op">=</span> LabelEncoder().fit_transform(df[feature])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="one-hot-encoding-the-categorical-features" class="level4">
<h4 class="anchored" data-anchor-id="one-hot-encoding-the-categorical-features"><strong>2.5.2 One-Hot Encoding the Categorical Features</strong></h4>
<p>The categorical features (<code>Pclass</code>, <code>Sex</code>, <code>Deck</code>, <code>Embarked</code>, <code>Title</code>) are converted to one-hot encoded features with <code>OneHotEncoder</code>. <code>Age</code> and <code>Fare</code> features are not converted because they are ordinal unlike the previous ones.</p>
<div id="cell-71" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a>cat_features <span class="op">=</span> [<span class="st">'Pclass'</span>, <span class="st">'Sex'</span>, <span class="st">'Deck'</span>, <span class="st">'Embarked'</span>, <span class="st">'Title'</span>, <span class="st">'Family_Size_Grouped'</span>]</span>
<span id="cb47-2"><a href="#cb47-2"></a>encoded_features <span class="op">=</span> []</span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="cf">for</span> df <span class="kw">in</span> dfs:</span>
<span id="cb47-5"><a href="#cb47-5"></a>    <span class="cf">for</span> feature <span class="kw">in</span> cat_features:</span>
<span id="cb47-6"><a href="#cb47-6"></a>        encoded_feat <span class="op">=</span> OneHotEncoder().fit_transform(df[feature].values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).toarray()</span>
<span id="cb47-7"><a href="#cb47-7"></a>        n <span class="op">=</span> df[feature].nunique()</span>
<span id="cb47-8"><a href="#cb47-8"></a>        cols <span class="op">=</span> [<span class="st">'</span><span class="sc">{}</span><span class="st">_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(feature, n) <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb47-9"><a href="#cb47-9"></a>        encoded_df <span class="op">=</span> pd.DataFrame(encoded_feat, columns<span class="op">=</span>cols)</span>
<span id="cb47-10"><a href="#cb47-10"></a>        encoded_df.index <span class="op">=</span> df.index</span>
<span id="cb47-11"><a href="#cb47-11"></a>        encoded_features.append(encoded_df)</span>
<span id="cb47-12"><a href="#cb47-12"></a></span>
<span id="cb47-13"><a href="#cb47-13"></a>df_train <span class="op">=</span> pd.concat([df_train, <span class="op">*</span>encoded_features[:<span class="dv">6</span>]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-14"><a href="#cb47-14"></a>df_test <span class="op">=</span> pd.concat([df_test, <span class="op">*</span>encoded_features[<span class="dv">6</span>:]], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="conclusion-1" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-1"><strong>2.6 Conclusion</strong></h3>
<p><code>Age</code> and <code>Fare</code> features are binned. Binning helped dealing with outliers and it revealed some homogeneous groups in those features. <code>Family_Size</code> is created by adding <code>Parch</code> and <code>SibSp</code> features and <strong>1</strong>. <code>Ticket_Frequency</code> is created by counting the occurence of <code>Ticket</code> values.</p>
<p><code>Name</code> feature is very useful. First, <code>Title</code> and <code>Is_Married</code> features are created from the title prefix in the names. Second, <code>Family_Survival_Rate</code> and <code>Family_Survival_Rate_NA</code> features are created by target encoding the surname of the passengers. <code>Ticket_Survival_Rate</code> is created by target encoding the <code>Ticket</code> feature. <code>Survival_Rate</code> feature is created by averaging the <code>Family_Survival_Rate</code> and <code>Ticket_Survival_Rate</code> features.</p>
<p>Finally, the non-numeric type features are label encoded and categorical features are one-hot encoded. Created <strong>5</strong> new features (<code>Family_Size</code>, <code>Title</code>, <code>Is_Married</code>, <code>Survival_Rate</code> and <code>Survival_Rate_NA</code>) and dropped the useless features after encoding.</p>
<p>::: {#cell-73 .cell _kg_hide-input=‘true’ execution_count=40}</p>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>df_all <span class="op">=</span> concat_df(df_train, df_test)</span>
<span id="cb48-2"><a href="#cb48-2"></a>drop_cols <span class="op">=</span> [<span class="st">'Deck'</span>, <span class="st">'Embarked'</span>, <span class="st">'Family'</span>, <span class="st">'Family_Size'</span>, <span class="st">'Family_Size_Grouped'</span>, <span class="st">'Survived'</span>,</span>
<span id="cb48-3"><a href="#cb48-3"></a>             <span class="st">'Name'</span>, <span class="st">'Parch'</span>, <span class="st">'PassengerId'</span>, <span class="st">'Pclass'</span>, <span class="st">'Sex'</span>, <span class="st">'SibSp'</span>, <span class="st">'Ticket'</span>, <span class="st">'Title'</span>,</span>
<span id="cb48-4"><a href="#cb48-4"></a>            <span class="st">'Ticket_Survival_Rate'</span>, <span class="st">'Family_Survival_Rate'</span>, <span class="st">'Ticket_Survival_Rate_NA'</span>, <span class="st">'Family_Survival_Rate_NA'</span>]</span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a>df_all.drop(columns<span class="op">=</span>drop_cols, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a>df_all.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Deck_1</th>
<th data-quarto-table-cell-role="th">Deck_2</th>
<th data-quarto-table-cell-role="th">Deck_3</th>
<th data-quarto-table-cell-role="th">Deck_4</th>
<th data-quarto-table-cell-role="th">Embarked_1</th>
<th data-quarto-table-cell-role="th">Embarked_2</th>
<th data-quarto-table-cell-role="th">Embarked_3</th>
<th data-quarto-table-cell-role="th">Family_Size_Grouped_1</th>
<th data-quarto-table-cell-role="th">Family_Size_Grouped_2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Pclass_3</th>
<th data-quarto-table-cell-role="th">Sex_1</th>
<th data-quarto-table-cell-role="th">Sex_2</th>
<th data-quarto-table-cell-role="th">Survival_Rate</th>
<th data-quarto-table-cell-role="th">Survival_Rate_NA</th>
<th data-quarto-table-cell-role="th">Ticket_Frequency</th>
<th data-quarto-table-cell-role="th">Title_1</th>
<th data-quarto-table-cell-role="th">Title_2</th>
<th data-quarto-table-cell-role="th">Title_3</th>
<th data-quarto-table-cell-role="th">Title_4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.383838</td>
<td>0.0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.000000</td>
<td>1.0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>...</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.383838</td>
<td>0.0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.383838</td>
<td>0.0</td>
<td>2</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>...</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.383838</td>
<td>0.0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 26 columns</p>
</div>
</div>
<p>:::</p>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model"><strong>3. Model</strong></h2>
<div id="cell-75" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>X_train <span class="op">=</span> StandardScaler().fit_transform(df_train.drop(columns<span class="op">=</span>drop_cols))</span>
<span id="cb49-2"><a href="#cb49-2"></a>y_train <span class="op">=</span> df_train[<span class="st">'Survived'</span>].values</span>
<span id="cb49-3"><a href="#cb49-3"></a>X_test <span class="op">=</span> StandardScaler().fit_transform(df_test.drop(columns<span class="op">=</span>drop_cols))</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="bu">print</span>(<span class="st">'X_train shape: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(X_train.shape))</span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="bu">print</span>(<span class="st">'y_train shape: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(y_train.shape))</span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="bu">print</span>(<span class="st">'X_test shape: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(X_test.shape))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X_train shape: (891, 26)
y_train shape: (891,)
X_test shape: (418, 26)</code></pre>
</div>
</div>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest"><strong>3.1 Random Forest</strong></h3>
<p>Created 2 <code>RandomForestClassifier</code>’s. One of them is a single model and the other is for k-fold cross validation.</p>
<p>The highest accuracy of the <code>single_best_model</code> is <strong>0.82775</strong> in public leaderboard. However, it doesn’t perform better in k-fold cross validation. It is a good model to start experimenting and hyperparameter tuning.</p>
<p>The highest accuracy of <code>leaderboard_model</code> is <strong>0.83732</strong> in public leaderboard with 5-fold cross validation. This model is created for leaderboard score and it is tuned to overfit slightly. It is designed to overfit because the estimated probabilities of <code>X_test</code> in every fold are going to be divided by <strong>N</strong> (fold count). If this model is used as a single model, it would struggle to predict lots of samples correctly.</p>
<p><strong>Which model should I use?</strong> * <code>leaderboard_model</code> overfits to test set so it’s not suggested to use models like this in real life projects. * <code>single_best_model</code> is a good model to start experimenting and learning about decision trees.</p>
<div id="cell-77" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>single_best_model <span class="op">=</span> RandomForestClassifier(criterion<span class="op">=</span><span class="st">'gini'</span>, </span>
<span id="cb51-2"><a href="#cb51-2"></a>                                           n_estimators<span class="op">=</span><span class="dv">1100</span>,</span>
<span id="cb51-3"><a href="#cb51-3"></a>                                           max_depth<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb51-4"><a href="#cb51-4"></a>                                           min_samples_split<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb51-5"><a href="#cb51-5"></a>                                           min_samples_leaf<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb51-6"><a href="#cb51-6"></a>                                           max_features<span class="op">=</span><span class="st">'auto'</span>,</span>
<span id="cb51-7"><a href="#cb51-7"></a>                                           oob_score<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb51-8"><a href="#cb51-8"></a>                                           random_state<span class="op">=</span>SEED,</span>
<span id="cb51-9"><a href="#cb51-9"></a>                                           n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb51-10"><a href="#cb51-10"></a>                                           verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-11"><a href="#cb51-11"></a></span>
<span id="cb51-12"><a href="#cb51-12"></a>leaderboard_model <span class="op">=</span> RandomForestClassifier(criterion<span class="op">=</span><span class="st">'gini'</span>,</span>
<span id="cb51-13"><a href="#cb51-13"></a>                                           n_estimators<span class="op">=</span><span class="dv">1750</span>,</span>
<span id="cb51-14"><a href="#cb51-14"></a>                                           max_depth<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb51-15"><a href="#cb51-15"></a>                                           min_samples_split<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb51-16"><a href="#cb51-16"></a>                                           min_samples_leaf<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb51-17"><a href="#cb51-17"></a>                                           max_features<span class="op">=</span><span class="st">'auto'</span>,</span>
<span id="cb51-18"><a href="#cb51-18"></a>                                           oob_score<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb51-19"><a href="#cb51-19"></a>                                           random_state<span class="op">=</span>SEED,</span>
<span id="cb51-20"><a href="#cb51-20"></a>                                           n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb51-21"><a href="#cb51-21"></a>                                           verbose<span class="op">=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>StratifiedKFold</code> is used for stratifying the target variable. The folds are made by preserving the percentage of samples for each class in target variable (<code>Survived</code>).</p>
<div id="cell-79" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>N <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>oob <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>probs <span class="op">=</span> pd.DataFrame(np.zeros((<span class="bu">len</span>(X_test), N <span class="op">*</span> <span class="dv">2</span>)), columns<span class="op">=</span>[<span class="st">'Fold_</span><span class="sc">{}</span><span class="st">_Prob_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(i, j) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, N <span class="op">+</span> <span class="dv">1</span>) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>)])</span>
<span id="cb52-4"><a href="#cb52-4"></a>importances <span class="op">=</span> pd.DataFrame(np.zeros((X_train.shape[<span class="dv">1</span>], N)), columns<span class="op">=</span>[<span class="st">'Fold_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, N <span class="op">+</span> <span class="dv">1</span>)], index<span class="op">=</span>df_all.columns)</span>
<span id="cb52-5"><a href="#cb52-5"></a>fprs, tprs, scores <span class="op">=</span> [], [], []</span>
<span id="cb52-6"><a href="#cb52-6"></a></span>
<span id="cb52-7"><a href="#cb52-7"></a>skf <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span>N, random_state<span class="op">=</span>N, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-8"><a href="#cb52-8"></a></span>
<span id="cb52-9"><a href="#cb52-9"></a><span class="cf">for</span> fold, (trn_idx, val_idx) <span class="kw">in</span> <span class="bu">enumerate</span>(skf.split(X_train, y_train), <span class="dv">1</span>):</span>
<span id="cb52-10"><a href="#cb52-10"></a>    <span class="bu">print</span>(<span class="st">'Fold </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(fold))</span>
<span id="cb52-11"><a href="#cb52-11"></a>    </span>
<span id="cb52-12"><a href="#cb52-12"></a>    <span class="co"># Fitting the model</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>    leaderboard_model.fit(X_train[trn_idx], y_train[trn_idx])</span>
<span id="cb52-14"><a href="#cb52-14"></a>    </span>
<span id="cb52-15"><a href="#cb52-15"></a>    <span class="co"># Computing Train AUC score</span></span>
<span id="cb52-16"><a href="#cb52-16"></a>    trn_fpr, trn_tpr, trn_thresholds <span class="op">=</span> roc_curve(y_train[trn_idx], leaderboard_model.predict_proba(X_train[trn_idx])[:, <span class="dv">1</span>])</span>
<span id="cb52-17"><a href="#cb52-17"></a>    trn_auc_score <span class="op">=</span> auc(trn_fpr, trn_tpr)</span>
<span id="cb52-18"><a href="#cb52-18"></a>    <span class="co"># Computing Validation AUC score</span></span>
<span id="cb52-19"><a href="#cb52-19"></a>    val_fpr, val_tpr, val_thresholds <span class="op">=</span> roc_curve(y_train[val_idx], leaderboard_model.predict_proba(X_train[val_idx])[:, <span class="dv">1</span>])</span>
<span id="cb52-20"><a href="#cb52-20"></a>    val_auc_score <span class="op">=</span> auc(val_fpr, val_tpr)  </span>
<span id="cb52-21"><a href="#cb52-21"></a>      </span>
<span id="cb52-22"><a href="#cb52-22"></a>    scores.append((trn_auc_score, val_auc_score))</span>
<span id="cb52-23"><a href="#cb52-23"></a>    fprs.append(val_fpr)</span>
<span id="cb52-24"><a href="#cb52-24"></a>    tprs.append(val_tpr)</span>
<span id="cb52-25"><a href="#cb52-25"></a>    </span>
<span id="cb52-26"><a href="#cb52-26"></a>    <span class="co"># X_test probabilities</span></span>
<span id="cb52-27"><a href="#cb52-27"></a>    probs.loc[:, <span class="st">'Fold_</span><span class="sc">{}</span><span class="st">_Prob_0'</span>.<span class="bu">format</span>(fold)] <span class="op">=</span> leaderboard_model.predict_proba(X_test)[:, <span class="dv">0</span>]</span>
<span id="cb52-28"><a href="#cb52-28"></a>    probs.loc[:, <span class="st">'Fold_</span><span class="sc">{}</span><span class="st">_Prob_1'</span>.<span class="bu">format</span>(fold)] <span class="op">=</span> leaderboard_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb52-29"><a href="#cb52-29"></a>    importances.iloc[:, fold <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> leaderboard_model.feature_importances_</span>
<span id="cb52-30"><a href="#cb52-30"></a>        </span>
<span id="cb52-31"><a href="#cb52-31"></a>    oob <span class="op">+=</span> leaderboard_model.oob_score_ <span class="op">/</span> N</span>
<span id="cb52-32"><a href="#cb52-32"></a>    <span class="bu">print</span>(<span class="st">'Fold </span><span class="sc">{}</span><span class="st"> OOB Score: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(fold, leaderboard_model.oob_score_))   </span>
<span id="cb52-33"><a href="#cb52-33"></a>    </span>
<span id="cb52-34"><a href="#cb52-34"></a><span class="bu">print</span>(<span class="st">'Average OOB Score: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(oob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fold 1

Fold 1 OOB Score: 0.8553370786516854

Fold 2

Fold 2 OOB Score: 0.844319775596073

Fold 3

Fold 3 OOB Score: 0.8513323983169705

Fold 4

Fold 4 OOB Score: 0.8359046283309958

Fold 5

Fold 5 OOB Score: 0.8260869565217391

Average OOB Score: 0.8425961674834928</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed:    0.3s
[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed:    0.6s
[Parallel(n_jobs=-1)]: Done 1218 tasks      | elapsed:    0.9s
[Parallel(n_jobs=-1)]: Done 1750 out of 1750 | elapsed:    1.3s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed:    0.3s
[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed:    0.5s
[Parallel(n_jobs=-1)]: Done 1218 tasks      | elapsed:    0.8s
[Parallel(n_jobs=-1)]: Done 1750 out of 1750 | elapsed:    1.2s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed:    0.3s
[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed:    0.5s
[Parallel(n_jobs=-1)]: Done 1218 tasks      | elapsed:    0.8s
[Parallel(n_jobs=-1)]: Done 1750 out of 1750 | elapsed:    1.2s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed:    0.3s
[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed:    0.5s
[Parallel(n_jobs=-1)]: Done 1218 tasks      | elapsed:    0.8s
[Parallel(n_jobs=-1)]: Done 1750 out of 1750 | elapsed:    1.2s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=-1)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=-1)]: Done 168 tasks      | elapsed:    0.1s
[Parallel(n_jobs=-1)]: Done 418 tasks      | elapsed:    0.3s
[Parallel(n_jobs=-1)]: Done 768 tasks      | elapsed:    0.5s
[Parallel(n_jobs=-1)]: Done 1218 tasks      | elapsed:    0.8s
[Parallel(n_jobs=-1)]: Done 1750 out of 1750 | elapsed:    1.2s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished
[Parallel(n_jobs=16)]: Using backend ThreadingBackend with 16 concurrent workers.
[Parallel(n_jobs=16)]: Done  18 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 168 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 418 tasks      | elapsed:    0.0s
[Parallel(n_jobs=16)]: Done 768 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1218 tasks      | elapsed:    0.1s
[Parallel(n_jobs=16)]: Done 1750 out of 1750 | elapsed:    0.1s finished</code></pre>
</div>
</div>
</section>
<section id="feature-importance" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance"><strong>3.2 Feature Importance</strong></h3>
<p>::: {#cell-81 .cell _kg_hide-input=‘true’ execution_count=44}</p>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>importances[<span class="st">'Mean_Importance'</span>] <span class="op">=</span> importances.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>importances.sort_values(by<span class="op">=</span><span class="st">'Mean_Importance'</span>, inplace<span class="op">=</span><span class="va">True</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a></span>
<span id="cb55-4"><a href="#cb55-4"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">20</span>))</span>
<span id="cb55-5"><a href="#cb55-5"></a>sns.barplot(x<span class="op">=</span><span class="st">'Mean_Importance'</span>, y<span class="op">=</span>importances.index, data<span class="op">=</span>importances)</span>
<span id="cb55-6"><a href="#cb55-6"></a></span>
<span id="cb55-7"><a href="#cb55-7"></a>plt.xlabel(<span class="st">''</span>)</span>
<span id="cb55-8"><a href="#cb55-8"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb55-9"><a href="#cb55-9"></a>plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb55-10"><a href="#cb55-10"></a>plt.title(<span class="st">'Random Forest Classifier Mean Feature Importance Between Folds'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb55-11"><a href="#cb55-11"></a></span>
<span id="cb55-12"><a href="#cb55-12"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="roc-curve" class="level3">
<h3 class="anchored" data-anchor-id="roc-curve"><strong>3.3 ROC Curve</strong></h3>
<p>::: {#cell-83 .cell _kg_hide-input=‘true’ execution_count=45}</p>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">def</span> plot_roc_curve(fprs, tprs):</span>
<span id="cb56-2"><a href="#cb56-2"></a>    </span>
<span id="cb56-3"><a href="#cb56-3"></a>    tprs_interp <span class="op">=</span> []</span>
<span id="cb56-4"><a href="#cb56-4"></a>    aucs <span class="op">=</span> []</span>
<span id="cb56-5"><a href="#cb56-5"></a>    mean_fpr <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb56-6"><a href="#cb56-6"></a>    f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb56-7"><a href="#cb56-7"></a>    </span>
<span id="cb56-8"><a href="#cb56-8"></a>    <span class="co"># Plotting ROC for each fold and computing AUC scores</span></span>
<span id="cb56-9"><a href="#cb56-9"></a>    <span class="cf">for</span> i, (fpr, tpr) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(fprs, tprs), <span class="dv">1</span>):</span>
<span id="cb56-10"><a href="#cb56-10"></a>        tprs_interp.append(np.interp(mean_fpr, fpr, tpr))</span>
<span id="cb56-11"><a href="#cb56-11"></a>        tprs_interp[<span class="op">-</span><span class="dv">1</span>][<span class="dv">0</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb56-12"><a href="#cb56-12"></a>        roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb56-13"><a href="#cb56-13"></a>        aucs.append(roc_auc)</span>
<span id="cb56-14"><a href="#cb56-14"></a>        ax.plot(fpr, tpr, lw<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, label<span class="op">=</span><span class="st">'ROC Fold </span><span class="sc">{}</span><span class="st"> (AUC = </span><span class="sc">{:.3f}</span><span class="st">)'</span>.<span class="bu">format</span>(i, roc_auc))</span>
<span id="cb56-15"><a href="#cb56-15"></a>        </span>
<span id="cb56-16"><a href="#cb56-16"></a>    <span class="co"># Plotting ROC for random guessing</span></span>
<span id="cb56-17"><a href="#cb56-17"></a>    plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Random Guessing'</span>)</span>
<span id="cb56-18"><a href="#cb56-18"></a>    </span>
<span id="cb56-19"><a href="#cb56-19"></a>    mean_tpr <span class="op">=</span> np.mean(tprs_interp, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb56-20"><a href="#cb56-20"></a>    mean_tpr[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb56-21"><a href="#cb56-21"></a>    mean_auc <span class="op">=</span> auc(mean_fpr, mean_tpr)</span>
<span id="cb56-22"><a href="#cb56-22"></a>    std_auc <span class="op">=</span> np.std(aucs)</span>
<span id="cb56-23"><a href="#cb56-23"></a>    </span>
<span id="cb56-24"><a href="#cb56-24"></a>    <span class="co"># Plotting the mean ROC</span></span>
<span id="cb56-25"><a href="#cb56-25"></a>    ax.plot(mean_fpr, mean_tpr, color<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Mean ROC (AUC = </span><span class="sc">{:.3f}</span><span class="st"> $\pm$ </span><span class="sc">{:.3f}</span><span class="st">)'</span>.<span class="bu">format</span>(mean_auc, std_auc), lw<span class="op">=</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb56-26"><a href="#cb56-26"></a>    </span>
<span id="cb56-27"><a href="#cb56-27"></a>    <span class="co"># Plotting the standard deviation around the mean ROC Curve</span></span>
<span id="cb56-28"><a href="#cb56-28"></a>    std_tpr <span class="op">=</span> np.std(tprs_interp, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb56-29"><a href="#cb56-29"></a>    tprs_upper <span class="op">=</span> np.minimum(mean_tpr <span class="op">+</span> std_tpr, <span class="dv">1</span>)</span>
<span id="cb56-30"><a href="#cb56-30"></a>    tprs_lower <span class="op">=</span> np.maximum(mean_tpr <span class="op">-</span> std_tpr, <span class="dv">0</span>)</span>
<span id="cb56-31"><a href="#cb56-31"></a>    ax.fill_between(mean_fpr, tprs_lower, tprs_upper, color<span class="op">=</span><span class="st">'grey'</span>, alpha<span class="op">=</span><span class="fl">.2</span>, label<span class="op">=</span><span class="st">'$\pm$ 1 std. dev.'</span>)</span>
<span id="cb56-32"><a href="#cb56-32"></a>    </span>
<span id="cb56-33"><a href="#cb56-33"></a>    ax.set_xlabel(<span class="st">'False Positive Rate'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb56-34"><a href="#cb56-34"></a>    ax.set_ylabel(<span class="st">'True Positive Rate'</span>, size<span class="op">=</span><span class="dv">15</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb56-35"><a href="#cb56-35"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb56-36"><a href="#cb56-36"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb56-37"><a href="#cb56-37"></a>    ax.set_xlim([<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>])</span>
<span id="cb56-38"><a href="#cb56-38"></a>    ax.set_ylim([<span class="op">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>])</span>
<span id="cb56-39"><a href="#cb56-39"></a></span>
<span id="cb56-40"><a href="#cb56-40"></a>    ax.set_title(<span class="st">'ROC Curves of Folds'</span>, size<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb56-41"><a href="#cb56-41"></a>    ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>, prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">13</span>})</span>
<span id="cb56-42"><a href="#cb56-42"></a>    </span>
<span id="cb56-43"><a href="#cb56-43"></a>    plt.show()</span>
<span id="cb56-44"><a href="#cb56-44"></a></span>
<span id="cb56-45"><a href="#cb56-45"></a>plot_roc_curve(fprs, tprs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02wk-00-itanic-advanced-feature-engineering-tutorial_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
<p>:::</p>
</section>
<section id="submission" class="level3">
<h3 class="anchored" data-anchor-id="submission"><strong>3.4 Submission</strong></h3>
<div id="cell-85" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>class_survived <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> probs.columns <span class="cf">if</span> col.endswith(<span class="st">'Prob_1'</span>)]</span>
<span id="cb57-2"><a href="#cb57-2"></a>probs[<span class="st">'1'</span>] <span class="op">=</span> probs[class_survived].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> N</span>
<span id="cb57-3"><a href="#cb57-3"></a>probs[<span class="st">'0'</span>] <span class="op">=</span> probs.drop(columns<span class="op">=</span>class_survived).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> N</span>
<span id="cb57-4"><a href="#cb57-4"></a>probs[<span class="st">'pred'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>pos <span class="op">=</span> probs[probs[<span class="st">'1'</span>] <span class="op">&gt;=</span> <span class="fl">0.5</span>].index</span>
<span id="cb57-6"><a href="#cb57-6"></a>probs.loc[pos, <span class="st">'pred'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb57-7"><a href="#cb57-7"></a></span>
<span id="cb57-8"><a href="#cb57-8"></a>y_pred <span class="op">=</span> probs[<span class="st">'pred'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb57-9"><a href="#cb57-9"></a></span>
<span id="cb57-10"><a href="#cb57-10"></a>submission_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'PassengerId'</span>, <span class="st">'Survived'</span>])</span>
<span id="cb57-11"><a href="#cb57-11"></a>submission_df[<span class="st">'PassengerId'</span>] <span class="op">=</span> df_test[<span class="st">'PassengerId'</span>]</span>
<span id="cb57-12"><a href="#cb57-12"></a>submission_df[<span class="st">'Survived'</span>] <span class="op">=</span> y_pred.values</span>
<span id="cb57-13"><a href="#cb57-13"></a>submission_df.to_csv(<span class="st">'submissions.csv'</span>, header<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-14"><a href="#cb57-14"></a>submission_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PassengerId</th>
<th data-quarto-table-cell-role="th">Survived</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">891</td>
<td>892</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">892</td>
<td>893</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">893</td>
<td>894</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">894</td>
<td>895</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">895</td>
<td>896</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">896</td>
<td>897</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">897</td>
<td>898</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">898</td>
<td>899</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">899</td>
<td>900</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">900</td>
<td>901</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>